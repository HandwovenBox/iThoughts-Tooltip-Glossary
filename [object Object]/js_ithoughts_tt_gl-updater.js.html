<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: js/ithoughts_tt_gl-updater.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: js/ithoughts_tt_gl-updater.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Handles the dialog logic between server updates operations and client
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license http://www.gnu.org/licenses/old-licenses/gpl-2.0.fr.html GPLv2
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.5.0
 */

(function(){
	var progress;
	var text;
	var initData;
	var verboseArea;

	function runUpdate(progression){
		$.post(ithoughts_tt_gl.admin_ajax, {
			action: "ithoughts_tt_gl_update", data: {
				versions: Updater,
				progression: progression,
				maxAdvandement: initData.max
			}
		}, function(out){
			if(verboseArea.parentElement.scrollTop > (verboseArea.parentElement.scrollHeight - verboseArea.parentElement.clientHeight) - 50){
				verboseArea.parentElement.scrollTop = verboseArea.parentElement.scrollHeight;
			}
			var scrollValOld = (verboseArea.parentElement.scrollHeight - verboseArea.parentElement.clientHeight);
			console.log(scrollValOld, verboseArea.parentElement.scrollTop)
			progress.value = out.data.progression;
			text.innerHTML = progress.value + '/' + initData.max + ' (&lt;em>' + (parseInt((progress.value / initData.max) * 100) + "").slice(0,3) + '%&lt;/em>)';
			if(out.data.verbose){
				for(var i = 0,j = out.data.verbose.length; i &lt; j; i++){
					$(verboseArea).append($.parseHTML('&lt;p class="' + out.data.verbose[i].type + '">' + out.data.verbose[i].text + '&lt;/p>'));
				}
			}
			if(verboseArea.parentElement.scrollTop > scrollValOld - 50){
				verboseArea.parentElement.scrollTop = verboseArea.parentElement.scrollHeight;
			}
			if(out.data.progression &lt; initData.max){
				runUpdate(out.data.progression);
			} else {
				Updater.from = initData.targetversion;
				jQuery.post(ithoughts_tt_gl.admin_ajax, {
					action: "ithoughts_tt_gl_update_done", data: {
						newversion: Updater.from,
					}
				}, function(out){
					if(out.success)
						initUpdate(Updater);
				});
			}
		});
	}

	function initUpdate(versions){
		console.log("Init step update", versions);
		$.post(ithoughts_tt_gl.admin_ajax, {
			action: "ithoughts_tt_gl_update", data: {
				versions: versions,
				progression: -1,
				maxAdvandement: -1
			}
		}, function(out){
			var updaterSection = $("#Updater");

			verboseArea = '&lt;div class="verboseContainer postbox closed">&lt;div class="handlediv" title="Cliquer pour inverser.">&lt;/div>&lt;h4 class="hndle ui-sortable-handle">Logs&lt;/h4>&lt;div class="inside">&lt;pre class="verboseArea">';
			if(out.data.verbose){
				for(var i = 0,j = out.data.verbose.length; i &lt; j; i++){
					verboseArea += '&lt;p class="' + out.data.verbose[i].type + '">' + out.data.verbose[i].text + '&lt;/p>';
				}
			}
			verboseArea += '&lt;/pre>&lt;/div>&lt;/div>';
			postboxes.add_postbox_toggles(pagenow);
			if(out.data.Ended){
				updaterSection.append($.parseHTML('&lt;article data-version="ended">&lt;h3>' + out.data.title + '&lt;/h3>&lt;p class="updatedescription">' + out.data.text + '&lt;/p>&lt;/article>'));
				postboxes.add_postbox_toggles(pagenow);
			} else {
				updaterSection.append($.parseHTML('&lt;article data-version="' + out.data.targetversion + '">&lt;h3>V' + out.data.targetversion + '&lt;/h3>&lt;p class="updatedescription">' + out.data.text + '&lt;/p>&lt;progress class="updateprogress" min="0" max="' + out.data.max + '" value="0">&lt;/progress>&lt;span class="updateprogresstext">0/' + out.data.max + ' (&lt;em>0%&lt;/em>)&lt;/span>' + verboseArea + '&lt;/article>'));
				postboxes.add_postbox_toggles(pagenow);
				initData = out.data;
				progress = qs("[data-version=\"" + out.data.targetversion + "\"] .updateprogress");
				text = qs("[data-version=\"" + out.data.targetversion + "\"] .updateprogresstext");
				verboseArea = qs("[data-version=\"" + out.data.targetversion + "\"] .verboseArea");

				runUpdate(0);
			}
		});
	}

	initUpdate(Updater);
})();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Document.html">Document</a></li><li><a href="Element.html">Element</a></li><li><a href="EventTarget.html">EventTarget</a></li><li><a href="NodeList.html">NodeList</a></li><li><a href="Object.html">Object</a></li></ul><h3>Global</h3><ul><li><a href="global.html#doInitTooltips">doInitTooltips</a></li><li><a href="global.html#isNA">isNA</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html">setTabSpecificBehavior</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Jul 15 2016 18:29:22 GMT-1000 (TAHT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
