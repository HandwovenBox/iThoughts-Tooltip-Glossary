ithoughts_tt_gl.initStyleEditor=function(e){function t(t,n,o){var r=!1,a=0
do{var i=n.find(t)
i.length>0?(r=!0,n=i):(n=e(n.parent()),a++)}while(o>=a&&!r)
return r?n:!1}function n(){for(var t={},n=document.styleSheets.length,o=0;n>o;o++)try{var r,a=document.styleSheets[o].cssRules
r="undefined"!=typeof a&&a?a.length:0
for(var i=0;r>i;i++){var l=a[i]
l instanceof CSSFontFaceRule&&(t[l.style.getPropertyValue("font-family")]||(t[l.style.getPropertyValue("font-family")]={}),t[l.style.getPropertyValue("font-family")][l.style.getPropertyValue("font-style")]||(t[l.style.getPropertyValue("font-family")][l.style.getPropertyValue("font-style")]=[]),t[l.style.getPropertyValue("font-family")][l.style.getPropertyValue("font-style")].push(l.style.getPropertyValue("font-weight")))}}catch(c){console.error("Error while retrieving font list",c,o)
continue}var s={}
for(var u in t){var d=t[u]
for(var p in d){var f=d[p]
if(""!=u){var h=function(){for(var e=[],t=0,n=f.length;n>t;t++)-1===e.indexOf(f[t])&&e.push(f[t])
return e}().filter(function(e){return""!==e})
if(h.length>0){var g={},v=u.replace(/^['"]?(.+?)['"]?$/,"$1")
g[v]={},g[v][p]=h,s=e.extend(s,g)}}}}console.log("Fonts available:",s)
for(var u in s)e('[name$="_tf"]').append(e.parseHTML('<option value="'+encodeURIComponent(u)+'">'+u+"</option>"))
e('[name$="_tf"] option[value=""]').text("Please select...")}function o(){e("#copyclip").prop("disabled",!0)
var t=!0
if(l.find("input, select, textarea").each(function(e,n){return t?(t&=n.checkValidity(),n.checkValidity()?void 0:(console.log(n.name,"is invalid"),void n.focus())):void 0}),t){e("#copyclip").prop("disabled",!1)
var n={global:{},title:{},content:{},unclassed:{}},o={g_:"global",c_:"content",t_:"title"},r={plain:"background:%VAL%","sh-e":function(e,t,n){return"-webkit-box-shadow:%VAL%;box-shadow:%VAL%".replace(/%VAL%/g,function(){return n.checked?[c["sh-h"],c["sh-w"],c["sh-s"],c["sh-c"]].map(function(e){return e.value}).join(" ")+(c["sh-i"].checked?" inset":""):"none"}())},tce:"color:%VAL%",pd:"padding:%VAL%","border-w":function(e,t,o){return n.unclassed.tipcolor="background-color: "+c["border-c"].value,"border:%VAL%;".replace(/%VAL%/g,function(){return[c["border-w"],c["border-s"],c["border-c"]].map(function(e){return e.value}).join(" ")}())},ts:"font-size:%VAL%",tf:function(e,t,n){return'font-family:"'+decodeURIComponent(t)+'",sans-serif'},lh:"line-height:%VAL%",tc:"color:%VAL%",ta:"text-align:%VAL%",custom:"%VAL%"}
l.find("input, select, textarea").each(function(e,t){var a=t.name.match(/^(.*?_)?([\w\d\-]*)$/),i=a[2],l=a[1]
l="undefined"!=typeof o[l]&&o[l]?o[l]:"unclassed","undefined"!=typeof r[i]&&r[i]&&("string"==typeof r[i]?n[l][i]=r[i].replace(/%VAL%/g,t.value):"function"==typeof r[i]?n[l][i]=r[i](function(e){return"undefined"==typeof e||null==e?"unclassed":e}(Object.keys(o).filter(function(e){return o[e]===l})[0]),t.value,t):console.warn("Unhandled property type",typeof r[i],"for property",i))}),console.log(n)
var a={global:".qtip-"+c.theme_name.value,title:".qtip-"+c.theme_name.value+" .qtip-titlebar",content:".qtip-"+c.theme_name.value+" .qtip-content"},i="";(n.global["box-shadow"]=n.unclassed["sh-e"])&&delete n.unclassed["sh-e"],(n.global.border=n.unclassed["border-w"])&&delete n.unclassed["border-w"]
for(var s in a){i+=a[s]+"{"
for(var u in n[s])n[s][u]&&n[s][u].length>0&&(i+="\n	"+n[s][u]+";")
i+="\n}\n\n"}if(n.unclassed.custom&&n.unclassed.custom.length>0&&(i+=n.unclassed.custom),n.unclassed.tipcolor&&n.unclassed.tipcolor.length>0&&(i+=a.global+" .qtip-tip{\n	"+n.unclassed.tipcolor+"\n}\n\n"),n.unclassed.tce&&n.unclassed.tce.length>0){var d=",",p=d+a.content+" "
i+=(p+["a","em"].join(p)).slice(d.length)+"{\n	"+n.unclassed.tce+"\n}\n\n"}c.outputcss.value=i
var f=e("#ithoughts_tt_gl-custom_theme")
0==f.length&&(f=e(e.parseHTML('<style id="ithoughts_tt_gl-custom_theme"></style>')),e("body").append(f)),f[0].innerHTML=i,window.updateStyle(null,c.theme_name.value)}}window.refloat(),e(".color-field").each(function(t,n){n.setAttribute("name",n.getAttribute("name"))
var o=n.cloneNode(!0)
e(n).parent().append(e(o).css("display","none").prop("name",e(o).prop("name")+"_hidden").prop("id",e(o).prop("id")+"_hidden")),Object.defineProperty(n,"value",{get:function(){return this.getAttribute("value")},set:function(e){if(o.value=e,this.setAttribute("value",e),"createEvent"in document){var t=document.createEvent("HTMLEvents")
t.initEvent("change",!1,!0),n.dispatchEvent(t)}else{var t=document.createEventObject()
n.fireEvent("onchange",t)}}})}).wpColorPicker()
var r=2
e("select.modeswitcher").each(function(n,o){e(o).bind("keydown click change",function(n){for(var o=e(this),a=e(this).val(),i=[],l=e(this).find("option"),c=0;c<l.length;c++)i.push(l[c].getAttribute("value"))
i=i.filter(function(e){return e!=a})
for(var s=i.length,c=0;s>c;c++){var u=t('[data-switcher-mode="'+i[c]+'"]',o,r)
u&&u.css("display","none")}var d=t('[data-switcher-mode="'+a+'"]',o,r)
return d===!1?void console.warn("Can't find switcher-mode "+a+'" at max-depth '+r+" for element",this):void d.css("display","block")}).change()}),e("#customizing-form .postbox").each(function(t,n){e(n).find(".hndle").click(function(){e(n).toggleClass("closed")})})
var a=[],i=e(e.parseHTML('<div id="ithoughts_tt_gl_stylesheets"></div>'))
e("body").append(i),e('link[rel="stylesheet"]').each(function(t,o){var r=e(o).clone()
r[0].setAttribute("crossorigin","anonymous")
var l=r[0].getAttribute("href")+"#"
a.push(l),r[0].setAttribute("href",l),i.append(r),r[0].onload=function(e){a.splice(a.indexOf(e.target.getAttribute("href")),1),0==a.length&&n()}}),e("input[pattern]").on("change keyup click",function(t){t.target.value.match(new RegExp(t.target.getAttribute("pattern")))?e(t.target).qtip("api")&&e(t.target).qtip("api").destroy():(t.target.removeAttribute("title"),e(t.target).qtip("api")?e(t.target).qtip("api").set("content.text",t.target.getAttribute("data-pattern-infos")):e(t.target).qtip({content:{text:t.target.getAttribute("data-pattern-infos"),title:{text:"Invalid format"}},hide:"focusout",position:{at:"center right",my:"bottom left",viewport:e("body"),container:e("#ithoughts_tooltip_glossary-tipsContainer")},show:{ready:!0,event:"focusin"}}))}),e("[data-child-form-controled]").each(function(t,n){var o=n.getAttribute("data-child-form-controled")
e(n).bind("click change",function(){var t=n.checked
e('[data-child-form="'+o+'-true"]').prop("disabled",!t),e('[data-child-form="'+o+'-false"]').prop("disabled",t)}).change()})
var l=e("#customizing-form"),c=l[0]
l.find("input, select, textarea").bind("change",o),e("#compilecss").bind("click",function(e){e.preventDefault(),o()}),e("#copyclip").bind("click",function(t){t.preventDefault(),c.outputcss.select()
var n=e("#copyclipres")
document.queryCommandSupported("copy")&&document.execCommand("copy")?n.text(n[0].getAttribute("data-text-success")).removeClass().addClass("updated"):n.text(n[0].getAttribute("data-text-error")).removeClass().addClass("error"),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()})}
