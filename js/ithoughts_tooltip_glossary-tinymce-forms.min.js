!function(){$d.ready(function(){function t(t){try{tinymce.EditorManager.execCommand("mceRemoveEditor",!0,t)}catch(e){console.warn("Force cleaning needed: ",e),tinymce.EditorManager.editors=tinymce.EditorManager.editors.filter(function(e){return e.id!=t})}}function e(){n.offset().top,$w.height()+$w.scrollTop()}function i(){n.find("*:focus")||o.is(":focus")||n.addClass("hidden")}function a(){var t=[],a=[]
ithoughts_tt_gl_tinymce_form.terms.map(function(e){var i=e.title.toLowerCase().indexOf(searchedString)
return-1==i&&(i=e.slug.toLowerCase().indexOf(searchedString)),-1!=i?0==i?void t.push(e):void a.push(e):void 0})
var r=t.concat(a)
n.empty()
var l=r.length
if(l>0)for(var s=0;l>s;s++){var d=r[s]
n.append($.parseHTML('<div tabindex="0" class="option" data-id="'+d.id+'" data-excerpt="'+d.content+'"><p><b>'+d.title+"</b><br><em>"+d.slug+"</em></p></div>"))}else n.append($.parseHTML('<p style="text-align:center"><em>No results</em><p>'))
n.removeClass("hidden"),setTimeout(e,25),n.find(".option").on("focusout",i).on("click",function(t){$('[name="glossary_term_id"]').val(t.currentTarget.getAttribute("data-id")),o[0].value=$(t.currentTarget).find("p > b").text(),n.addClass("hidden")})}$(".tabs li").click(function(t){if(!$(this).hasClass("active")){$(this).parent().find(".active").removeClass("active"),$(this).addClass("active"),$(t.target).parent().parent().find(" > .active").removeClass("active")
var e=$(t.target).index()
switch(console.log(e),$($(t.target).parent().parent().children()[e+1]).addClass("active"),linkInput=gei("itghouts_tt_gl_link"),e){case 0:linkInput.disabled=!0
break
case 1:linkInput.disabled=!1
break
case 2:linkInput.disabled=!1}}}),$editors=$("#ithoughts_tt_gl-tooltip-form-container .tinymce"),$editors.each(function(t,e){for(text=e.value;null==e.getAttribute("id");){var i="editor"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10)
gei(i)||e.setAttribute("id",i)}var a=e.getAttribute("id")
tinymce.init({selector:"#"+a,menubar:!1,external_plugins:{code:ithoughts_tt_gl_tinymce_form.base_tinymce+"/code/plugin.min.js",wordcount:ithoughts_tt_gl_tinymce_form.base_tinymce+"/wordcount/plugin.min.js"},plugins:"wplink",toolbar:["styleselect | bold italic underline link | bullist numlist | alignleft aligncenter alignright alignjustify | code"],min_height:70,height:70,resize:!1})
var o=setInterval(function(){tinymce.get(a)&&(clearInterval(o),tinymce.get(a).setContent(text.replace(/&/g,"&amp;")))},50)}),$(".modeswitcher").on("click keyup",function(){var t=this.id
$("[data-"+t+"]:not([data-"+t+'="mediatip-'+this.value+'-type"])').hide(),$("[data-"+t+'~="mediatip-'+this.value+'-type"]').show()}).keyup(),$("#ithoughts_tt_gl_select_image").click(function(){onclickEntryPoint=this,window.mb=window.mb||{},window.mb.frame=wp.media({frame:"post",state:"insert",library:{type:["audio","video","image"]},multiple:!1}),window.mb.frame.on("insert",function(){var t=window.mb.frame.state().get("selection").first().toJSON()
console.log(t),0>$.trim(t.url.length)||($("#image-box-data").val(JSON.stringify({url:t.url,id:t.id,link:t.link})),gei("image-box").innerHTML='<img src="'+t.url+'"/>',gei("mediatip_caption").value=t.caption,gei("ithoughts_tt_gl_link").value=t.link)}),window.mb.frame.open()})
var o=$("#glossary_term"),n=$("#glossary_term_completer")
$w.resize(e)
var r=null
o.on("keyup focusin",function(){r&&r.abort(),searchedString=removeAccents($(this).val().toLowerCase()),r=$.ajax({url:ithoughts_tt_gl_tinymce_form.admin_ajax,method:"POST",dataType:"json",data:{action:"ithoughts_tt_gl_get_terms_list",search:searchedString},complete:function(t){var e=t.responseJSON
if("undefined"!=typeof e&&e.success){if(e.data.searched!=searchedString)return void console.log("Outdated response")
ithoughts_tt_gl_tinymce_form.terms=e.data.terms,a()}}}),a()}).on("focusout",i).on("keyup",function(){this.removeAttribute("data-term-id")}),$("#ithoughts_tt_gl-tinymce-validate").click(function(){var e={type:["glossary","tooltip","mediatip"][$(".tabs li.active").index()],text:gei("ithoughts_tt_gl_text").value,link:gei("ithoughts_tt_gl_link").value}
switch(e.type){case"glossary":e=$.extend(e,{glossary_id:$('[name="glossary_term_id"]').val()})
break
case"tooltip":e=$.extend(e,{tooltip_content:tinymce.EditorManager.get("ithoughts_tt_gl-tooltip-content").getContent()||$("#ithoughts_tt_gl-tooltip-content").val()})
break
case"mediatip":switch(e=$.extend(e,{mediatip_type:$("#mediatip_type").val()}),e.mediatip_type){case"localimage":e=$.extend(e,{mediatip_content:$("#image-box-data").val(),mediatip_caption:$("#mediatip_caption").val()})
break
case"webimage":e=$.extend(e,{mediatip_content:$("#mediatip_url_image").val(),mediatip_caption:$("#mediatip_caption").val()})
break
case"webvideo":e=$.extend(e,{mediatip_content:$("#mediatip_url_video_embed").val(),mediatip_link:$("#mediatip_url_video_link").val()})}}setTimeout(function(){t("ithoughts_tt_gl-tooltip-content")},500),$("#ithoughts_tt_gl-tooltip-form-container")[0].finish(e)}),$(".ithoughts_tt_gl-tinymce-discard").click(function(){setTimeout(function(){t("ithoughts_tt_gl-tooltip-content")},500),$("#ithoughts_tt_gl-tooltip-form-container")[0].finish()}),$("#mediatip_url_video_link").bind("keyup mouseup change click focusin focusout",function(){var t=null,e={direct:{regex:/^(.*\.mp4)(\?.*)?$/,embed:'<video width="512" height="288" controls="controls"><source src="$1" type="video/mp4" /></video>',video:"$1"},youtube:{regex:/^(?:https?:\/\/(?:youtu\.be\/|\w*\.youtube\.\w{2,3}\/watch\?v=)|<iframe .*?src="https?:\/\/\w*\.youtube\.\w{2,3}\/embed\/)([a-zA-Z0-9]*).*$/,embed:'<iframe width="512" height="288" src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>',video:"https://www.youtube.com/watch?v=$1"},dailymotion:{regex:/^(?:https?:\/\/(?:dai\.ly\/|\w*\.dailymotion\.\w{2,3}\/video\/)|<iframe .*?src=".*?\w*\.dailymotion\.\w{2,3}\/embed\/video\/)([a-zA-Z0-9]*).*/,embed:'<iframe width="512" height="288" src="https://www.dailymotion.com/embed/video/$1" frameborder="0" allowfullscreen></iframe>',video:"https://www.dailymotion.com/video/$1"}}
for(var i in e)if(this.value.match(e[i].regex)){t={embed:this.value.replace(e[i].regex,e[i].embed),video:this.value.replace(e[i].regex,e[i].video)}
break}t&&($("#mediatip_url_video_embed").val(t.embed),$("#mediatip_url_video_link").val(t.video))}).keyup()})}()
