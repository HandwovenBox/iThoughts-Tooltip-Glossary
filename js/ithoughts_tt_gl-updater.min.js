/**
 * @file Handles the dialog logic between server updates operations and client
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license http://www.gnu.org/licenses/old-licenses/gpl-2.0.fr.html GPLv2
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.5.0
 */
!function(){function e(n){$.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update",data:{versions:Updater,progression:n,maxAdvandement:r.max}},function(n){o.parentElement.scrollTop>o.parentElement.scrollHeight-o.parentElement.clientHeight-50&&(o.parentElement.scrollTop=o.parentElement.scrollHeight);var d=o.parentElement.scrollHeight-o.parentElement.clientHeight;if(a.value=n.data.progression,s.innerHTML=a.value+"/"+r.max+" (<em>"+(parseInt(a.value/r.max*100)+"").slice(0,3)+"%</em>)",n.data.verbose)for(var p=0,i=n.data.verbose.length;i>p;p++)$(o).append($.parseHTML('<p class="'+n.data.verbose[p].type+'">'+n.data.verbose[p].text+"</p>"));o.parentElement.scrollTop>d-50&&(o.parentElement.scrollTop=o.parentElement.scrollHeight),n.data.progression<r.max?e(n.data.progression):(Updater.from=r.targetversion,jQuery.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update_done",data:{newversion:Updater.from}},function(e){e.success&&t(Updater)}))})}function t(t){$.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update",data:{versions:t,progression:-1,maxAdvandement:-1}},function(t){var n=$("#Updater");if(o='<div class="verboseContainer postbox closed"><div class="handlediv" title="Cliquer pour inverser."></div><h4 class="hndle ui-sortable-handle">Logs</h4><div class="inside"><pre class="verboseArea">',t.data.verbose)for(var d=0,p=t.data.verbose.length;p>d;d++)o+='<p class="'+t.data.verbose[d].type+'">'+t.data.verbose[d].text+"</p>";o+="</pre></div></div>",postboxes.add_postbox_toggles(pagenow),t.data.Ended?(n.append($.parseHTML('<article data-version="ended"><h3>'+t.data.title+'</h3><p class="updatedescription">'+t.data.text+"</p></article>")),postboxes.add_postbox_toggles(pagenow)):(n.append($.parseHTML('<article data-version="'+t.data.targetversion+'"><h3>V'+t.data.targetversion+'</h3><p class="updatedescription">'+t.data.text+'</p><progress class="updateprogress" min="0" max="'+t.data.max+'" value="0"></progress><span class="updateprogresstext">0/'+t.data.max+" (<em>0%</em>)</span>"+o+"</article>")),postboxes.add_postbox_toggles(pagenow),r=t.data,a=qs('[data-version="'+t.data.targetversion+'"] .updateprogress'),s=qs('[data-version="'+t.data.targetversion+'"] .updateprogresstext'),o=qs('[data-version="'+t.data.targetversion+'"] .verboseArea'),e(0))})}var a,s,r,o;t(Updater)}();