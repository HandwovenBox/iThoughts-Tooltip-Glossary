!function(){function e(n){$.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update",data:{versions:Updater,progression:n,maxAdvandement:o.max}},function(n){r.parentElement.scrollTop>r.parentElement.scrollHeight-r.parentElement.clientHeight-50&&(r.parentElement.scrollTop=r.parentElement.scrollHeight)
var p=r.parentElement.scrollHeight-r.parentElement.clientHeight
if(console.log(p,r.parentElement.scrollTop),a.value=n.data.progression,s.innerHTML=a.value+"/"+o.max+" (<em>"+(parseInt(a.value/o.max*100)+"").slice(0,3)+"%</em>)",n.data.verbose)for(var d=0,i=n.data.verbose.length;i>d;d++)$(r).append($.parseHTML('<p class="'+n.data.verbose[d].type+'">'+n.data.verbose[d].text+"</p>"))
r.parentElement.scrollTop>p-50&&(r.parentElement.scrollTop=r.parentElement.scrollHeight),n.data.progression<o.max?e(n.data.progression):(Updater.from=o.targetversion,jQuery.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update_done",data:{newversion:Updater.from}},function(e){e.success&&t(Updater)}))})}function t(t){console.log("Init step update",t),$.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update",data:{versions:t,progression:-1,maxAdvandement:-1}},function(t){var n=$("#Updater")
if(r='<div class="verboseContainer postbox closed"><div class="handlediv" title="Cliquer pour inverser."></div><h4 class="hndle ui-sortable-handle">Logs</h4><div class="inside"><pre class="verboseArea">',t.data.verbose)for(var p=0,d=t.data.verbose.length;d>p;p++)r+='<p class="'+t.data.verbose[p].type+'">'+t.data.verbose[p].text+"</p>"
r+="</pre></div></div>",postboxes.add_postbox_toggles(pagenow),t.data.Ended?(n.append($.parseHTML('<article data-version="ended"><h3>'+t.data.title+'</h3><p class="updatedescription">'+t.data.text+"</p></article>")),postboxes.add_postbox_toggles(pagenow)):(n.append($.parseHTML('<article data-version="'+t.data.targetversion+'"><h3>V'+t.data.targetversion+'</h3><p class="updatedescription">'+t.data.text+'</p><progress class="updateprogress" min="0" max="'+t.data.max+'" value="0"></progress><span class="updateprogresstext">0/'+t.data.max+" (<em>0%</em>)</span>"+r+"</article>")),postboxes.add_postbox_toggles(pagenow),o=t.data,a=qs('[data-version="'+t.data.targetversion+'"] .updateprogress'),s=qs('[data-version="'+t.data.targetversion+'"] .updateprogresstext'),r=qs('[data-version="'+t.data.targetversion+'"] .verboseArea'),e(0))})}var a,s,o,r
t(Updater)}()
