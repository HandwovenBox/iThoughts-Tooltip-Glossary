/*! ithoughts-tooltip-glossary build on 2017-06-27 05:44:48 for v3.0.0 */
/**
 * @file Handles the dialog logic between server updates operations and client
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.7.0
 */
iThoughtsTooltipGlossary=iThoughtsTooltipGlossary||{},function(a){"use strict";function b(a,b){h='<div class="update-nag error"><p>An error occured during the update. Please see below for details</p></div><div class="verboseContainer postbox"><div class="handlediv"></div><h4 class="hndle ui-sortable-handle">Logs</h4><div class="inside"><pre class="verboseArea">'+a.stack+"Response from server: "+JSON.stringify(b,null,4)+"</pre></div></div>",i.append(h)}function c(a){j.post(iThoughtsTooltipGlossary.admin_ajax,{action:"ithoughts_tt_gl_update",data:{versions:l,progression:a,maxAdvancement:g.max}},function(a){h.parentElement.scrollTop>h.parentElement.scrollHeight-h.parentElement.clientHeight-50&&(h.parentElement.scrollTop=h.parentElement.scrollHeight);var k=h.parentElement.scrollHeight-h.parentElement.clientHeight;try{if(e.value=a.data.progression,f.innerHTML=e.value+"/"+g.max+" (<em>"+(parseInt(e.value/g.max*100)+"").slice(0,3)+"%</em>)",a.data.verbose)for(var m=0,n=a.data.verbose.length;m<n;m++)j(h).append(j.parseHTML('<p class="'+a.data.verbose[m].type+'">'+a.data.verbose[m].text+"</p>"));h.parentElement.scrollTop>k-50&&(h.parentElement.scrollTop=h.parentElement.scrollHeight),a.data.progression<g.max?c(a.data.progression):(l.from=g.targetversion,jQuery.post(iThoughtsTooltipGlossary.admin_ajax,{action:"ithoughts_tt_gl_update_done",data:{newversion:l.from}},function(b){if(b.success)d(l);else{var c="<hr/><h4>"+a.data.title+"</h4><p>"+a.data.text+"</p>";i.append(c)}}))}catch(c){b(c,a)}})}function d(a){j.post(iThoughtsTooltipGlossary.admin_ajax,{action:"ithoughts_tt_gl_update",data:{versions:a,progression:-1,maxAdvancement:-1}},function(a){i=j("#Updater");try{if(void 0===a||void 0===a.data)throw new Error("Empty server response");if(h='<div class="verboseContainer postbox closed"><div class="handlediv" title="Cliquer pour inverser."></div><h4 class="hndle ui-sortable-handle">Logs</h4><div class="inside"><pre class="verboseArea">',a.data.verbose)for(var d=0,l=a.data.verbose.length;d<l;d++)h+='<p class="'+a.data.verbose[d].type+'">'+a.data.verbose[d].text+"</p>";h+="</pre></div></div>",a.data.Ended?(i.append(j.parseHTML('<article data-version="ended"><h3>'+a.data.title+'</h3><p class="updatedescription">'+a.data.text+"</p></article>")),postboxes.add_postbox_toggles(m)):(i.append(j.parseHTML('<article data-version="'+a.data.targetversion+'"><h3>V'+a.data.targetversion+'</h3><p class="updatedescription">'+a.data.text+'</p><progress class="updateprogress" min="0" max="'+a.data.max+'" value="0"></progress><span class="updateprogresstext">0/'+a.data.max+" (<em>0%</em>)</span>"+h+"</article>")),postboxes.add_postbox_toggles(m),g=a.data,e=k('[data-version="'+a.data.targetversion+'"] .updateprogress'),f=k('[data-version="'+a.data.targetversion+'"] .updateprogresstext'),h=k('[data-version="'+a.data.targetversion+'"] .verboseArea'),c(0))}catch(c){b(c,a)}})}var e,f,g,h,i,j=a.$,k=a.qs,l=iThoughtsTooltipGlossaryUpdater,m=l.pagenow;delete l.pagenow,d(l)}(Ithoughts.v4);/**/