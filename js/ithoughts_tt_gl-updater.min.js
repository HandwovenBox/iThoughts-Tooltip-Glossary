!function(){function t(n){$.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update",data:{versions:Updater,progression:n,maxAdvandement:o.max}},function(n){r.parentElement.scrollTop>r.parentElement.scrollHeight-r.parentElement.clientHeight-50&&(r.parentElement.scrollTop=r.parentElement.scrollHeight)
var p=r.parentElement.scrollHeight-r.parentElement.clientHeight
if(console.log(p,r.parentElement.scrollTop),a.value=n.data.progression,s.innerHTML=a.value+"/"+o.max+" (<em>"+(parseInt(a.value/o.max*100)+"").slice(0,3)+"%</em>)",n.data.verbose)for(var d=0,i=n.data.verbose.length;i>d;d++)$(r).append($.parseHTML('<p class="'+n.data.verbose[d].type+'">'+n.data.verbose[d].text+"</p>"))
r.parentElement.scrollTop>p-50&&(r.parentElement.scrollTop=r.parentElement.scrollHeight),n.data.progression<o.max?t(n.data.progression):(Updater.from=o.targetversion,jQuery.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update_done",data:{newversion:Updater.from}},function(t){t.success&&e(Updater)}))})}function e(e){console.log("Init step update",e),$.post(ithoughts_tt_gl.admin_ajax,{action:"ithoughts_tt_gl_update",data:{versions:e,progression:-1,maxAdvandement:-1}},function(e){var n=$("#Updater")
if(r='<div class="verboseContainer postbox closed"><div class="handlediv" title="Cliquer pour inverser."></div><h4 class="hndle ui-sortable-handle">Logs</h4><div class="inside"><pre class="verboseArea">',e.data.verbose)for(var p=0,d=e.data.verbose.length;d>p;p++)r+='<p class="'+e.data.verbose[p].type+'">'+e.data.verbose[p].text+"</p>"
r+="</pre></div></div>",postboxes.add_postbox_toggles(pagenow),e.data.Ended?(n.append($.parseHTML('<article data-version="ended"><h3>'+e.data.title+'</h3><p class="updatedescription">'+e.data.text+"</p></article>")),postboxes.add_postbox_toggles(pagenow)):(n.append($.parseHTML('<article data-version="'+e.data.targetversion+'"><h3>V'+e.data.targetversion+'</h3><p class="updatedescription">'+e.data.text+'</p><progress class="updateprogress" min="0" max="'+e.data.max+'" value="0"></progress><span class="updateprogresstext">0/'+e.data.max+" (<em>0%</em>)</span>"+r+"</article>")),postboxes.add_postbox_toggles(pagenow),o=e.data,a=qs('[data-version="'+e.data.targetversion+'"] .updateprogress'),s=qs('[data-version="'+e.data.targetversion+'"] .updateprogresstext'),r=qs('[data-version="'+e.data.targetversion+'"] .verboseArea'),t(0))})}var a,s,o,r
e(Updater)}()
