/*! ithoughts-tooltip-glossary build on 2017-04-22 09:35:44 for v2.7.0 */
/**
 * @file Client-side scripts for handling tooltip creation wizzard in Wordpress TinyMCE
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.7.0
 */
!function(a){"use strict";var b=a.$,c=a.$d,d=a.$w,e=ithoughts_tt_gl_editor;c.ready(function(){function a(a,c){a.click(function(a){b(this).parent().find(".active").removeClass("active"),b(this).addClass("active"),b(a.target).parent().parent().find(" > .active").removeClass("active");var d=b(a.target).index();b(b(a.target).parent().parent().children()[d+1]).addClass("active"),c&&c(d)}),a.filter(".active").click()}var c="";if(b("#ithoughts_tt_gl-tooltip-form-container").length)c="TIP";else{if(!b("#ithoughts_tt_gl-list-form-container").length)return;c="LIST"}"TIP"==c?function(){function c(a){try{tinymce.EditorManager.execCommand("mceRemoveEditor",!0,a)}catch(b){console.warn("Force cleaning needed: ",b),tinymce.EditorManager.editors=tinymce.EditorManager.editors.filter(function(b){return b.id!=a})}}function f(){var a=k.offset().top-d.scrollTop(),b=d.height(),c=b-a;l.css({maxHeight:c})}function g(){setTimeout(function(){k.find("*:focus").length||j.is(":focus")||l.addClass("hidden")},100)}function h(){var a=[],c=[];e.terms.map(function(b){var d=b.title.toLowerCase().indexOf(m);if(-1==d&&(d=b.slug.toLowerCase().indexOf(m)),-1!=d)return 0==d?void a.push(b):void c.push(b)});var d=a.concat(c);k.empty();var g=d.length;if(g>0)for(var h=0;h<g;h++){var i=d[h];void 0===i.thislang||i.thislang?k.append(b.parseHTML('<div tabindex="0" class="option" data-id="'+i.id+'" data-excerpt="'+i.content+'"><p><b>'+i.title+"</b><br><em>"+i.slug+"</em></p></div>")):k.append(b.parseHTML('<div tabindex="0" class="option foreign-language" data-id="'+i.id+'" data-excerpt="'+i.content+'"><p><b>'+i.title+"</b><br><em>"+i.slug+"</em></p></div>"))}else k.append(b.parseHTML('<p style="text-align:center"><em>No results</em><p>'));l.removeClass("hidden"),setTimeout(f,25),k.find(".option").on("click",function(a){b('[name="glossary_term_id"]').val(a.currentTarget.getAttribute("data-id")),j[0].value=b(a.currentTarget).find("p > b").text(),l.addClass("hidden")})}a(b("#ithoughts_tt_gl-tooltip-form .tabs li"),function(a){b("#ithoughts_tt_gl_link").prop("disabled",0==a)}),a(b("#ithoughts_tt_gl-tooltip-form-options .tabs li")),b("#ithoughts_tt_gl-tooltip-form-container .tinymce").each(function(a,c){for(var d=c.value;null==c.getAttribute("id");){var f="editor"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,10);b(f).length||c.setAttribute("id",f)}var g=c.getAttribute("id");tinymce.init({selector:"#"+g,menubar:!1,external_plugins:{code:e.base_tinymce+"/code/plugin.min.js",wordcount:e.base_tinymce+"/wordcount/plugin.min.js"},plugins:"wplink",toolbar:["styleselect | bold italic underline link | bullist numlist | alignleft aligncenter alignright alignjustify | code"],min_height:70,height:70,resize:!1});var h=setInterval(function(){var a=tinymce.get(g);a&&a.getDoc()&&a.getBody()&&(e.log("Initing subeditor with content ",JSON.stringify(d)),clearInterval(h),a.setContent(d.replace(/&/g,"&amp;")))},50)}),b(".modeswitcher").on("click keyup",function(){var a=this.id;b("[data-"+a+"]:not([data-"+a+'="mediatip-'+this.value+'-type"])').hide(),b("[data-"+a+'~="mediatip-'+this.value+'-type"]').show()}).keyup(),b("#ithoughts_tt_gl_select_image").click(function(){onclickEntryPoint=this,window.mb=window.mb||{},window.mb.frame=wp.media({frame:"post",state:"insert",library:{type:["audio","video","image"]},multiple:!1}),window.mb.frame.on("insert",function(){var a=window.mb.frame.state().get("selection").first().toJSON();0>b.trim(a.url.length)||(b("#image-box-data").val(JSON.stringify({url:a.url,id:a.id,link:a.link})),b("#image-box").html('<img src="'+a.url+'"/>'),b("#mediatip_caption").val(a.caption),b("#ithoughts_tt_gl_link").val(a.link))}),window.mb.frame.open()});var i,j=b("#glossary_term"),k=b("#glossary_term_completer"),l=b("#glossary_term_completer_container"),m="",n=null;d.resize(f),j.on("keyup focusin",function(){n&&n.abort(),m=e.removeAccents(b(this).val().toLowerCase()),n=b.ajax({url:e.admin_ajax,method:"POST",dataType:"json",data:{action:"ithoughts_tt_gl_get_terms_list",search:m},complete:function(a){var b=a.responseJSON;if(void 0!==b&&b.success){if(b.data.searched!=m)return void console.info("Outdated response");e.terms=b.data.terms,h()}}}),h()}).on("focusout",g).on("keyup",function(){this.removeAttribute("data-term-id")}),b("#ithoughts_tt_gl-tinymce-validate").click(function(){var a={type:["glossary","tooltip","mediatip"][b(".tabs li.active").index()],text:b("#ithoughts_tt_gl_text").val(),link:b("#ithoughts_tt_gl_link").val(),opts:i};switch(e.log("Before per-type form data handling:",a),a.type){case"glossary":a=b.extend(a,{glossary_id:b('[name="glossary_term_id"]').val(),disable_auto_translation:b('[name="glossary_disable_auto_translation"]').is(":checked")});break;case"tooltip":a=b.extend(a,{tooltip_content:tinymce.EditorManager.get("ithoughts_tt_gl-tooltip-content").getContent()||b("#ithoughts_tt_gl-tooltip-content").val()});break;case"mediatip":switch(a=b.extend(a,{mediatip_type:b("#mediatip_type").val()}),a.mediatip_type){case"localimage":a=b.extend(a,{mediatip_content:b("#image-box-data").val(),mediatip_caption:b("#mediatip_caption").val()});break;case"webimage":a=b.extend(a,{mediatip_content:b("#mediatip_url_image").val(),mediatip_caption:b("#mediatip_caption").val()});break;case"webvideo":a=b.extend(a,{mediatip_content:b("#mediatip_url_video_embed").val(),mediatip_link:b("#mediatip_url_video_link").val()})}}setTimeout(function(){c("ithoughts_tt_gl-tooltip-content")},500),e.finishTipTinymce(a)}),b(".ithoughts_tt_gl-tinymce-discard").click(function(){setTimeout(function(){c("ithoughts_tt_gl-tooltip-content")},500),e.finishTipTinymce()}),b("#mediatip_url_video_link").bind("keyup mouseup change click focusin focusout",function(){var a=null,c={direct:{regex:/^(.*\.mp4)(\?.*)?$/,embed:'<video width="512" height="288" controls="controls"><source src="$1" type="video/mp4" /></video>',video:"$1"},youtube:{regex:/^(?:https?:\/\/(?:youtu\.be\/|\w*\.youtube\.\w{2,3}\/watch\?v=)|<iframe .*?src="https?:\/\/\w*\.youtube\.\w{2,3}\/embed\/)([a-zA-Z0-9]*).*$/,embed:'<iframe width="512" height="288" src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen></iframe>',video:"https://www.youtube.com/watch?v=$1"},dailymotion:{regex:/^(?:https?:\/\/(?:dai\.ly\/|\w*\.dailymotion\.\w{2,3}\/video\/)|<iframe .*?src=".*?\w*\.dailymotion\.\w{2,3}\/embed\/video\/)([a-zA-Z0-9]*).*/,embed:'<iframe width="512" height="288" src="https://www.dailymotion.com/embed/video/$1" frameborder="0" allowfullscreen></iframe>',video:"https://www.dailymotion.com/video/$1"}};for(var d in c)if(this.value.match(c[d].regex)){a={embed:this.value.replace(c[d].regex,c[d].embed),video:this.value.replace(c[d].regex,c[d].video)};break}a&&(b("#mediatip_url_video_embed").val(a.embed),b("#mediatip_url_video_link").val(a.video))}).keyup(),function(){function a(){for(var a,c=h[0],d=c.elements,e={},f=!0,g=d.length,i=-1,j={},k=b("#attributes-list option").map(function(){return this.value}).toArray();++i<g&&f;){var l=d[i].validity;f&=l.valid,l.valid||d[i].focus()}h.find(".ithoughts-tristate").each(function(){b.extend(!0,e,b(this).serializeInputsObject({"-1":!1,0:null,1:!0}[this.dataset.state]))}),a=b.extend(!0,h.serializeObject(),e);for(var m=["span","link"],i=0;i<2;i++){var n=m[i];j[n]={};for(var o=a["attributes-"+n+"-key"]||[],p=a["attributes-"+n+"-value"]||[],q=0,r=Math.min(o.length,p.length);q<r;q++)if(o[q]&&p[q]){var s=k.indexOf(o[q])>-1?"":"data-";j[n][s+o[q]]=p[q]}delete a["attributes-"+n+"-value"],delete a["attributes-"+n+"-key"]}return a.attributes=j,a}function c(){return 0===b(this).closest(".ithoughts-prototype").length}function d(){var a=b(this),c=a.parent().parent(),d=c.find("input").filter(function(){return this!=a.get(0)});setTimeout(function(){var b=a.closest(".ithoughts-attrs-container").attr("data-attr-family");if(g[b])return void(g[b]=!1);a.val(a.val().trim()),d.val(d.val().trim()),a.val()||d.val()||document.activeElement==a.get(0)||document.activeElement==d.get(0)||c.remove()},100)}var e=b("#ithoughts_tt_gl-tooltip-form-options"),f=b("#ithoughts_tt_gl-tooltip-form"),g={span:!1,link:!1},h=b("#ithoughts_tt_gl-tooltip-form-options form");e.find('input[type="checkbox"].ithoughts-tristate').attr("data-state",function(a,b){return((b||0)-1)%3+2}).change(function(a){var c=b(this),d=((c.attr("data-state")||0)-2)%3+1;c.attr("data-state",d),this.checked=1==d,this.indeterminate=0==d}).change(),i=a(),b("#ithoughts_tt_gl-tinymce-advanced_options").click(function(){e.show(),f.hide()}),b("#ithoughts_tt_gl-tinymce-close-attrs").click(function(){e.hide(),f.show()}),b("#ithoughts_tt_gl-tinymce-validate-attrs").click(function(){i=a(),e.hide(),f.show()}),b("#qtip-keep-open").change(function(){var a,c=b("#qtiptrigger"),d=b("#qtiptriggerText"),e=b([c,d]);return function(){c.prop("disabled",this.checked),d.prop("disabled",!this.checked),e.val(this.checked?"click":a),this.checked?a=c.value:c.disabled=!(d.disabled=!0)}}()),b('[name^="position[my]"]').change(function(){var a="#position[my][",c=b(a+"1]"),d=b(a+"2]"),e=b(d.get(0),c.get(0)),f=b(a+"invert]");return function(){e.prop("required",c.val()||d.val()||f.prop("checked"))}}()),b('[name^="position[at]"]').change(function(){var a="#position[at][",c=b(a+"1]"),d=b(a+"2]"),e=b(d.get(0),c.get(0));return function(){e.prop("required",c.val()||d.val())}}()),b("#kv-pair-link-attrs-add,#kv-pair-span-attrs-add").bind("mousedown touchstart",function(){var a=b(this).parent().find(".ithoughts-attrs-container");a.attr("data-attr-family")}).bind("mouseup touchend",function(){g[f]=!0;var a=b(this).parent().find(".ithoughts-attrs-container"),e=a.find("input:invalid").filter(c),f=a.attr("data-attr-family");if(e.length>0)return g[f]=!0,e.eq(0).focus(),d.call(e.get(0)),void(g[f]=!1);var h=a.find(".ithoughts-prototype"),i=h.clone().removeClass("ithoughts-prototype"),j=["attributes-"+f+"-","-"+(new Date).getTime()];i.find(".dynamicId").each(function(){var a=b(this),c=j[0]+(a.hasClass("dynamicId-key")?"key":"value")+j[1];a.attr("LABEL"==this.tagName?"for":"id",c)}),i.find("input").prop("required",!0).prop("disabled",!1),a.append(i),i.find("input").blur(d).eq(0).focus(),d.call(i.find("input").get(0))}),b(".ithoughts-attrs-container input").blur(d)}()}():"LIST"==c&&function(){a(b(".tabs li")),function(){var a=b("#groups"),c=b("#groups_text"),e=b("#groupspicker"),f=b([e.get(0),c.parent().get(0)]),g=b("#groupspicker .group-select input");c.focusin(function(){function a(){e.toggleClass("hidden"),f.off("click",b)}function b(a){a.stopImmediatePropagation()}e.toggleClass("hidden"),f.click(b),d.one("click",a)}),g.change(function(){var d=g.filter(":checked"),e=[],f=[];d.each(function(){e.push(b(this).parent().find(".group-title").text()),f.push(b(this).val())}),a.val(f.join(",")),c.val(e.join(", "))}).change()}(),b("#ithoughts_tt_gl-tinymce-validate").click(function(){var a={type:["atoz","list"][b(".tabs li.active").index()],alpha:b("#letters").val(),group:b("#groups").val()};switch(a.alpha||delete a.alpha,a.group||delete a.group,a.type){case"list":b.extend(a,{desc:b("#description_mode").val(),cols:b("#columns_count").val()})}e.finishListTinymce(a)}),b(".ithoughts_tt_gl-tinymce-discard").click(function(){e.finishListTinymce()})}()})}(Ithoughts.v4);/**/