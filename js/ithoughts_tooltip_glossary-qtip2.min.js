/**
 * @file Interface between plugin formatted data and qTip API
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license http://www.gnu.org/licenses/old-licenses/gpl-2.0.fr.html GPLv2
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.5.0
 */
function stripQuotes(t,e){return"string"!=typeof t?"":e?t.replace(/"/g,"&aquot;").replace(/\n/g,"<br/>"):t.replace(/<br\/>/g,"\n").replace(/&aquot;/g,'"')}ithoughts_tt_gl=ithoughts_tt_gl||{},ithoughts_tt_gl.doInitTooltips=function(t){var e,i=t.$,s=(t.$w,t.$d,ithoughts_tt_gl),o=t.isNA;return function(){o(e)&&(e=i(i.parseHTML('<div id="ithoughts_tooltip_glossary-tipsContainer"></div>')),i(document.body).append(e));var a={start:t.isIos?"mousedown":"touchstart",end:t.isIos?"mouseup":"touchend"};t.isIos&&i("body").css({cursor:"pointer"}),i("span[class^=ithoughts_tooltip_glossary-]").each(function(){var o=i(this).data("qtipstyle")?i(this).data("qtipstyle"):s.qtipstyle,n=i(this).data("termcontent")?i(this).data("termcontent"):s.termcontent,r=i(this).data("qtipshadown")?i(this).data("qtipshadown"):s.qtipshadown;r="true"===r||"1"===r;var h=i(this).data("qtiprounded")?i(this).data("qtiprounded"):s.qtiprounded;h="true"===h||"1"===h;var d=i(this).data("qtiptrigger")?i(this).data("qtiptrigger"):s.qtiptrigger;if("click"==d){var l=i(this);l.children("a").click(function(t){1!=l.touch&&(t.preventDefault(),l.touch=1)}).mouseleave(function(){l.touch=0})}else if("responsive"==d){var l=i(this);l.touch=t.baseTouch,i("body").bind("click touch",function(t){0==i(t.target).closest(l).length&&(l.data("expanded",!1),l.triggerHandler("responsiveout"))}),l.children("a").click(function(t){l.data("expanded")||0==l.touch||(l.data("expanded",!0),l.triggerHandler("responsive"),t.preventDefault())}).bind(a.start,function(t){l.touch=1}).bind(a.end,function(t){l.touch=2}).bind("mouseover focus",function(t){l.triggerHandler("responsive")}).bind("mouseleave focusout",function(t){l.triggerHandler("responsiveout")})}var u;u=this.getAttribute("data-tooltip-theme")?"qtip-"+this.getAttribute("data-tooltip-theme")+(r?" qtip-shadow":"")+(h?" qtip-rounded":"")+" ":this.getAttribute("data-tooltip-classes")?this.getAttribute("data-tooltip-classes"):"qtip-"+o+(r?" qtip-shadow":"")+(h?" qtip-rounded":"")+" ";var p;if(i(this).hasClass("ithoughts_tooltip_glossary-glossary"))if(this.getAttribute("data-termid")&&"off"!=n){var g={action:"ithoughts_tt_gl_get_term_details",content:n,termid:i(this).data().termid};"true"==this.getAttribute("data-disable_auto_translation")&&(g.disable_auto_translation=!0),p={content:{text:s.lang.qtip.pleasewait_ajaxload.content,ajax:{url:s.admin_ajax,type:"POST",data:g,dataType:"json",loading:!1,success:function(t,e){t.success?(this.set("content.title",t.data.title),this.set("content.text",t.data.content)):this.set("content.text","Error")}},title:{text:s.lang.qtip.pleasewait_ajaxload.title}},style:{classes:u+"ithoughts_tooltip_glossary-glossary"}}}else this.getAttribute("data-term-content")&&this.getAttribute("data-term-title")&&(p={content:{title:{text:this.getAttribute("data-term-title")},text:this.getAttribute("data-term-content")},style:{classes:u+"ithoughts_tooltip_glossary-glossary"}});else if(i(this).hasClass("ithoughts_tooltip_glossary-tooltip"))p={style:{classes:u+"ithoughts_tooltip_glossary-tooltip"},content:{text:stripQuotes(this.getAttribute("data-tooltip-content"),!1),title:{text:i(this).text()}}};else{if(!i(this).hasClass("ithoughts_tooltip_glossary-mediatip"))return;if(p={style:{classes:u+"ithoughts_tooltip_glossary-mediatip"},position:{adjust:{scroll:!1}},content:{text:"",title:{text:i(this).text()}},hide:{fixed:!0,delay:100},events:{show:function(){i(this).qtip().reposition()}}},this.getAttribute("data-mediatip-image")){var c={src:this.getAttribute("data-mediatip-image"),alt:i(this).text()};if("undefined"!=typeof s.qtip_filters&&s.qtip_filters&&"undefined"!=typeof s.qtip_filters.mediatip&&s.qtip_filters.mediatip&&s.qtip_filters.mediatip.length>0)for(var _=0;_<s.qtip_filters.mediatip.length;_++)c=i.extend(c,s.qtip_filters.mediatip[_](i(this)));var f="";for(var m in c)f+=m+'="'+c[m]+'" ';p.content.text="<img "+f+">";var v=this.getAttribute("data-mediatip-caption");v&&(p.content.text+='<div class="ithoughts_tt_gl-caption">'+v.replace(/&aquot;/g,'"')+"</div>")}else if(this.getAttribute("data-mediatip-html")){var b=function(t){return 1==t.length&&("IFRAME"==t[0].nodeName&&t[0].src.match(/youtube|dailymotion/)||"VIDEO"==t[0].nodeName)?redimVid(t):void 0}(i(i.parseHTML(this.getAttribute("data-mediatip-html").replace("&quot;",'"').trim())));p.content.text=b.text,p.content.title.text='<span class="ithoughts_tooltip_glossary_pin_container"><svg viewBox="0 0 26 26" class="ithoughts_tooltip_glossary_pin"><use xlink:href="#icon-pin"></use></svg></span><span class="ithoughts_tt_gl-title_with_pin">'+p.content.title.text+"</span>",p.style.classes+=" ithoughts_tt_gl-force_no_pad ithoughts_tt_gl-video_tip ithoughts_tt_gl-with_pin",p.style.width=b.dims.width,p.events.render=function(t,e){e.elements.title.find(".ithoughts_tooltip_glossary_pin_container").click(function(){i(this).toggleClass("pined"),i(this).hasClass("pined")?e.disable():e.enable()})}}}"true"==this.getAttribute("data-tooltip-autoshow")&&(p.show=i.extend(!0,p.show,{ready:!0})),"true"==this.getAttribute("data-tooltip-nosolo")&&(p.show=i.extend(!0,p.show,{solo:!1})),"true"==this.getAttribute("data-tooltip-nohide")&&(p=i.extend(!0,p,{hide:"someevent",show:{event:"someevent"}})),this.getAttribute("data-tooltip-id")&&(p=i.extend(!0,p,{id:this.getAttribute("data-tooltip-id")}));var y=i.extend(!0,{prerender:!0,position:{at:"top center",my:"bottom center",viewport:i("body"),effect:!1,container:e},show:{event:d,solo:!0},hide:"responsive"==d?"responsiveout":"mouseleave",style:u},p);i(this).qtip(y),i(this).find("a[title]").removeAttr("title")})}}(Ithoughts),function(t){function e(t){var e=o(document.createElement("div"));o(e).append(o(t));var e=e.html();return e}function i(i){for(var s=t.$w.height(),a=t.$w.width(),n=0,r=[[512,288],[256,144]],h=r.length;h>n&&!(a>r[n][0]&&s>r[n][1]);n++);n=Math.min(r.length,Math.max(0,n));var d=r[n];return"undefined"!=typeof i||"undefined"==typeof d?(i.prop({width:d[0],height:d[1]}).addClass("ithoughts_tt_gl-video"),{dims:{width:d[0],height:d[1]},text:e(i)}):(o(".ithoughts_tt_gl-video").prop({width:d[0],height:d[1]}),void o(".ithoughts_tt_gl-video_tip").each(function(){var t=o(this).qtip("api"),e=t.disabled;t.enable(),t.reposition(),t.disable(e)}).css({width:d[0],height:d[1]}))}var s,o=t.$,a=t.$w;a.resize(function(){clearTimeout(s),s=setTimeout(i,100)}),t.$d.ready(function(){ithoughts_tt_gl.doInitTooltips()})}(Ithoughts);