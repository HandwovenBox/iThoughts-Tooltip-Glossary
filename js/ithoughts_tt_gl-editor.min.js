/*! ithoughts-tooltip-glossary build on 2017-04-22 09:35:44 for v2.7.0 */
/**
 * @file Script loaded as soon a post editor is opened. It contains all basic functions to insert shortcodes
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.7.0
 */
!function(a){"use strict";a.$d.ready(function(){function b(){var a=d("#content").get(0),b={html:f.replaceShortcodes(a.value.substring(a.selectionStart,a.selectionEnd))};return b.DOM=d.parseHTML(b.html),b.start=d(b.DOM).first().get(0),b.end=d(b.DOM).last().get(0),b}function c(a,b,c){return b=String(b).trim(),a.match(/^[\w_\-]*$/)?g(a.trim(),!0)+'="'+(!l(c)&&c?b.replace(/"/g,"&aquot;").replace(/\n/g,"<br/>"):g(b,!0))+'"':null}var d=a.$,e=(a.$w,ithoughts_tt_gl),f=ithoughts_tt_gl_editor,g=e.stripQuotes,h="ithoughts-tooltip-glossary",i="ithoughts_tooltip_glossary",j=["ithoughts-tooltip-glossary-term","ithoughts-tooltip-glossary-tooltip","ithoughts-tooltip-glossary-mediatip"],k=["href"],l=a.isNA;a.initLoggers(f,"iThoughts Tooltip Glossary",f.verbosity),f.removeAccents=function(a){var b={"¹":"1","²":"2","³":"3","á":"a","à":"a","â":"a","ã":"a","ä":"a","å":"a",a:"a","À":"a","Á":"a","Â":"a","Ã":"a","Ä":"a","Å":"a",A:"a","Æ":"a",c:"c","ç":"c","©":"c",C:"c","Ç":"c","Ð":"d","è":"e","é":"e","ê":"e","?":"s","ë":"e",e:"e","È":"e","Ê":"e","Ë":"e",E:"e","€":"e",g:"g",G:"g",i:"i","ì":"i","í":"i","î":"i","ï":"i","Ì":"i","Í":"i","Î":"i","Ï":"i",I:"i",l:"l",L:"l",n:"n","ñ":"n",N:"n","Ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o",o:"o","ø":"o","Ò":"o","Ó":"o","Ô":"o","Õ":"o","Ö":"o",O:"o","Ø":"o","Œ":"o",r:"r","®":"r",R:"r","š":"s",s:"s","ß":"s","Š":"s",S:"s","ù":"u","ú":"u","û":"u","ü":"u",u:"u","Ù":"u","Ú":"u","Û":"u","Ü":"u",U:"u","ý":"y","ÿ":"y","Ý":"y","Ÿ":"y","ž":"z",z:"z","Ž":"z",Z:"z"};return a.replace(/[¹²³áàâãäåaaaÀÁÂÃÄÅAAAÆccç©CCÇÐÐèéê?ëeeeeeÈÊË?EEEEE€gGiìíîïìiiiÌÍÎÏ?ÌIIIlLnnñNNÑòóôõöoooøÒÓÔÕÖOOOØŒr®Ršs?ßŠS?ùúûüuuuuÙÚÛÜUUUUýÿÝŸžzzŽZZ]/g,function(a){return b[a]})},f.replaceShortcodes=function(a){for(var b=f.replaceShortcodesEl.length,c=-1;(c+=1)<b;)a=f.replaceShortcodesEl[c](a);return a},f.restoreShortcodes=function(a){for(var b=f.restoreShortcodesEl.length,c=-1;(c+=1)<b;)a=f.restoreShortcodesEl[c](a);return a},f.replaceShortcodesEl=[function(a){return a.replace(/\[(?:ithoughts_tooltip_glossary-)?(glossary|tooltip|mediatip)(?!_)(.*?)\](.*?)\[\/(?:ithoughts_tooltip_glossary-)?(glossary|tooltip|mediatip)\]/g,function(a,b,c,d){for(var e,f={},g=/([\w\d\-]+?)="(.+?)"/g,i=null,j='<a data-type="'+h+"-"+{glossary:"term",tooltip:"tooltip",mediatip:"mediatip"}[b]+'"';!0===Boolean(i=g.exec(c));)f[i[1]]=i[2];for(e in f)f.hasOwnProperty(e)&&(k.indexOf(e)>-1||0===e.indexOf("data-")?j+=" "+e+'="'+f[e]+'"':j+=" data-"+e+'="'+f[e]+'"');return j+">"+d+"</a>"})},function(a){return a.replace(/\[glossary_(term_list|atoz)(.*?)\/\]/g,function(a,b,c){for(var d,e={},f=/([\w\d\-]+?)="(.+?)"/g,g=null,i='<span data-type="'+h+"-"+b+'"';!0===Boolean(g=f.exec(c));)e[g[1]]=g[2];for(d in e)e.hasOwnProperty(d)&&(k.indexOf(d)>-1||0===d.indexOf("data-")?i+=" "+d+'="'+e[d]+'"':i+=" data-"+d+'="'+e[d]+'"');return i+">Glossary "+("term_list"===b?"List":"A-to-Z")+"</span>"})}],f.restoreShortcodesEl=[function(a){return a.replace(/<a\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term|tooltip|mediatip)")(.*?)>(.*?)<\/a>/g,function(a,b,c,d){for(var e,f={},g=/(data-)?([\w\d\-]+?)="(.+?)"/g,h=null,j={term:"glossary",tooltip:"tooltip",mediatip:"mediatip"}[b],l="["+i+"-"+j;!0===Boolean(h=g.exec(c));)"data-"===h[1]&&"type"===h[2]||(k.indexOf(h[2])>-1&&void 0!==h[1]?f[h[1]+h[2]]=h[3]:f[h[2]]=h[3]);for(e in f)f.hasOwnProperty(e)&&(l+=" "+e+'="'+f[e]+'"');return l+"]"+d+"[/"+i+"-"+j+"]"})},function(a){return a.replace(/<span\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term_list|atoz)")(.*?)>.*?<\/span>/g,function(a,b,c){for(var d,e={},f=/(data-)?([\w\d\-]+?)="(.+?)"/g,g=null,h="[glossary_"+b;!0===Boolean(g=f.exec(c));)"data-"===g[1]&&"type"===g[2]||(k.indexOf(d)>-1&&void 0!==g[1]?e[g[1]+g[2]]=g[3]:e[g[2]]=g[3]);for(d in e)e.hasOwnProperty(d)&&(h+=" "+d+'="'+e[d]+'"');return h+"/]"})}],f.editorForms={list:function(b,e,g){function h(a){return(a||"").split(",").map(Function.prototype.call,String.prototype.trim).filter(function(a){return a})}f.log("Selection infos to load TIP: ",b);var i,j="insert_content",k=b.start,m={type:"atoz",alpha:[],group:[]};l(b.start)||b.start!==b.end||(f.log("Start & End node are the same, operating on a node of type "+k.nodeName),k&&"#text"!=k.nodeName&&(d.extend(m,{alpha:h(k.getAttribute("data-alpha")),group:h(k.getAttribute("data-group"))}),"ithoughts-tooltip-glossary-atoz"===k.getAttribute("data-type")?(j="load",m.type="atoz"):"ithoughts-tooltip-glossary-term_list"===k.getAttribute("data-type")&&(j="load",m.type="list",d.extend(m,{cols:parseInt(k.getAttribute("data-cols")),desc:k.getAttribute("data-desc")})))),i=a.makeLoader(),d.ajax({method:"POST",async:!0,url:f.admin_ajax,data:{action:"ithoughts_tt_gl_get_tinymce_list_form",data:m},success:function(a){i.remove();var b=d(d.parseHTML(a,!0));d(document.body).append(b.css({opacity:0}).animate({opacity:1},500)),f.finishListTinymce=function(){var a=b;return function(b){if(f.info("New list data:",b),a.animate({opacity:0},500,function(){a.remove()}),void 0!==b){var d="glossary_"+{atoz:"atoz",list:"term_list"}[b.type],g="load"!==j&&0===content.length?" ":"",h=[],i=["alpha","group"];switch(b.type){case"list":i=i.concat(["cols","desc"])}for(var k=0,m=i.length;k<m;k++){var n=i[k];b.hasOwnProperty(n)&&function(a,b,d){h.push(c(a,b,d)),h=h.filter(function(a){return!l(a)})}(n,b[n])}var o="["+d+" "+h.join(" ")+"/]"+g;return f.log("Final content:",o),e(o,j)}}}()},error:function(){i.remove(),f.error("Error while getting TinyMCE form for Tip: ",arguments)}})},tip:function(b,e,h){f.info("Selection infos to load TIP: ",b);var k,m,n,o,p,q,r,s,t,u,v,w={},x=b.start,y=(d(x),""),z=-1;if(!l(b.start)&&b.start===b.end)if(f.log("Start & End node are the same, operating on a node of type "+x.nodeName),k=x&&x.text||b.html,f.log("Loading content: ",k),x&&"#text"!=x.nodeName&&j.indexOf(x.getAttribute("data-type"))>-1){for(y="load",o={},m=x.attributes,n=m.length;(z+=1)<n;)p=m[z],o[p.nodeName]=p.nodeValue;q=function(a,b){!l(b)&&b||(a="data-"+a);var c=o[a];return delete o[a],c},r=(q("position-at")||" ").split(" "),s=(q("position-my")||" ").split(" "),t=1===Math.max(s.indexOf("top"),s.indexOf("bottom"))||0===Math.max(s.indexOf("right"),s.indexOf("left")),r={1:r[0],2:r[1]},s={1:s[t?1:0],2:s[t?0:1],invert:t?"enabled":void 0},u=function(a){return"true"===a||"false"!==a&&null};var A=q("tooltip-content");h&&A&&(A=A.replace(/&lt;/g,"<").replace(/&gt;/g,">")),w={text:k,link:q("href",!0),tooltip_content:g(A||k,!1),glossary_id:q("glossary-id"),term_search:f.removeAccents(k.toLowerCase()),mediatip_type:q("mediatip-type"),mediatip_content:g(q("mediatip-content"),!1),mediatip_link:q("mediatip-link"),mediatip_caption:q("mediatip-caption"),type:["glossary","tooltip","mediatip"][j.indexOf(q("type"))],glossary_disable_auto_translation:"true"===(q("disable_auto_translation")||!1),opts:{termcontent:q("termcontent"),"qtip-keep-open":"true"===q("qtip-keep-open"),qtiprounded:u(q("qtiprounded")),qtipshadow:u(q("qtipshadow")),qtipstyle:q("qtipstyle"),qtiptrigger:q("qtiptrigger"),position:{at:r,my:s},attributes:{span:{},link:{}},anim:{in:q("animation_in"),out:q("animation_out"),time:q("animation_time")},maxwidth:q("tooltip-maxwidth")}};for(z in o)o.hasOwnProperty(z)&&(z.match(/^data-link-/)?w.opts.attributes.link[z.replace(/^data-link-(data-)?/,"")]=o[z]:w.opts.attributes.span[z.replace(/^data-/,"")]=o[z])}else k&&k.length>0?(y="replace_content",w={text:k,link:"",tooltip_content:k,glossary_id:null,term_search:f.removeAccents(k.toLowerCase()),mediatip_type:"",mediatip_content:"",mediatip_caption:"",type:"tooltip",glossary_disable_auto_translation:!1}):(y="add_content",w={text:"",link:"",tooltip_content:"",glossary_id:null,term_search:"",mediatip_type:"",mediatip_content:"",mediatip_caption:"",type:"tooltip",glossary_disable_auto_translation:!1});v=a.makeLoader(),d.ajax({method:"POST",async:!0,url:f.admin_ajax,data:{action:"ithoughts_tt_gl_get_tinymce_tooltip_form",data:w},success:function(a){v.remove();var b=d(d.parseHTML(a,!0));d(document.body).append(b.css({opacity:1}).animate({opacity:1},500)),f.finishTipTinymce=function(){var a=b;return function(b){if(f.info("New tooltip data:",b),a.animate({opacity:0},500,function(){a.remove()}),void 0!==b){var d,g,j,m,n=a.find("#attributes-list option").map(function(){return this.value}).toArray(),o=[],p=b.opts||w.opts,q=function(a,b,d){o.push(c(a,b,d)),o=o.filter(function(a){return!l(a)})},r=["span","link"],s=r.length,t=-1,u=p&&p.attributes||{},v=i+"-"+b.type,x="load"!==y&&0===k.length?" ":"";if(!l(p))for(p["qtip-content"]&&q("data-termcontent",p["qtip-content"]),p["qtip-keep-open"]&&q("data-qtip-keep-open","true"),l(p.qtiprounded)||q("data-qtiprounded",String(p.qtiprounded)),l(p.qtipshadow)||q("data-qtipshadow",String(p.qtipshadow)),p.qtipstyle&&q("data-qtipstyle",p.qtipstyle),p.qtiptrigger&&q("data-qtiptrigger",p.qtiptrigger),p.position&&(p.position.at&&p.position.at[1]&&p.position.at[2]&&q("data-position-at",p.position.at[1]+" "+p.position.at[2]),p.position.my&&p.position.my[1]&&p.position.my[2]&&(d=[p.position.my[1],p.position.my[2]],p.position.my.invert&&d.reverse(),q("data-position-my",d.join(" ")))),p.anim&&(p.anim.in&&q("data-animation_in",p.anim.in),p.anim.out&&q("data-animation_out",p.anim.out),p.anim.time&&q("data-animation_time",p.anim.time)),p.maxwidth&&q("data-tooltip-maxwidth",p.maxwidth);t++<s;){var z=r[t];if(u.hasOwnProperty(z))for(g in u[z])u[z].hasOwnProperty(g)&&(j=n.indexOf(g)>-1&&!g.startsWith("data-")?"":"data-",m="link"===z?"link-":"",q(j+m+g,u[z][g],!0))}if(b.link&&q("href",encodeURI(b.link)),"glossary"===b.type){if(!b.glossary_id||!b.text)return;q("glossary-id",b.glossary_id),b.disable_auto_translation&&q("disable_auto_translation","true")}else if("tooltip"===b.type){if(!b.tooltip_content||!b.text)return;q("tooltip-content",h?b.tooltip_content.replace(/</g,"&lt;").replace(/>/g,"&gt;"):b.tooltip_content,!0)}else if("mediatip"===b.type){if(!(b.mediatip_type&&b.mediatip_content&&b.text))return;q("mediatip-type",b.mediatip_type),q("mediatip-content",b.mediatip_content,!0),b.mediatip_caption&&q("mediatip-caption",b.mediatip_caption,!0)}var A="["+v+" "+o.join(" ")+"]"+b.text+"[/"+v+"]"+x;return f.log("Final content:",A),e(A,y)}}}()},error:function(){v.remove(),f.error("Error while getting TinyMCE form for Tip: ",arguments)}})}},QTags.addButton("ithoughts_tt_gl-tip","ITG Tip",function(){f.editorForms.tip(b(),QTags.insertContent,!0)}),QTags.addButton("ithoughts_tt_gl-list","ITG List",function(){f.editorForms.list(b(),QTags.insertContent,!0)})})}(Ithoughts.v4);/**/