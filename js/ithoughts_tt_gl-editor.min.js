/**
 * @file Script loaded as soon a post editor is opened. It contains all basic functions to insert shortcodes
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.7.0
 */
!function(t){"use strict";t.$d.ready(function(){function e(){var t=i("#content").get(0),e={html:n.replaceShortcodes(t.value.substring(t.selectionStart,t.selectionEnd))};return e.DOM=i.parseHTML(e.html),e.start=i(e.DOM).first().get(0),e.end=i(e.DOM).last().get(0),e}function o(t,e,o){return e=String(e).trim(),t.match(/^[\w_\-]*$/)?r(t.trim(),!0)+'="'+(!c(o)&&o?e.replace(/"/g,"&aquot;").replace(/\n/g,"<br/>"):r(e,!0))+'"':null}var i=t.$,a=(t.$w,ithoughts_tt_gl),n=ithoughts_tt_gl_editor,r=a.stripQuotes,s="ithoughts_tt_gl",p="ithoughts-tooltip-glossary",l="ithoughts_tooltip_glossary",d=["ithoughts-tooltip-glossary-term","ithoughts-tooltip-glossary-tooltip","ithoughts-tooltip-glossary-mediatip"],u=["href"],c=t.isNA;t.initLoggers(n,"iThoughts Tooltip Glossary",n.verbosity),n.removeAccents=function(t){var e=/[¹²³áàâãäåaaaÀÁÂÃÄÅAAAÆccç©CCÇÐÐèéê?ëeeeeeÈÊË?EEEEE€gGiìíîïìiiiÌÍÎÏ?ÌIIIlLnnñNNÑòóôõöoooøÒÓÔÕÖOOOØŒr®Ršs?ßŠS?ùúûüuuuuÙÚÛÜUUUUýÿÝŸžzzŽZZ]/g,o={"¹":"1","²":"2","³":"3","á":"a","à":"a","â":"a","ã":"a","ä":"a","å":"a",a:"a","À":"a","Á":"a","Â":"a","Ã":"a","Ä":"a","Å":"a",A:"a","Æ":"a",c:"c","ç":"c","©":"c",C:"c","Ç":"c","Ð":"d","è":"e","é":"e","ê":"e","?":"s","ë":"e",e:"e","È":"e","Ê":"e","Ë":"e",E:"e","€":"e",g:"g",G:"g",i:"i","ì":"i","í":"i","î":"i","ï":"i","Ì":"i","Í":"i","Î":"i","Ï":"i",I:"i",l:"l",L:"l",n:"n","ñ":"n",N:"n","Ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o",o:"o","ø":"o","Ò":"o","Ó":"o","Ô":"o","Õ":"o","Ö":"o",O:"o","Ø":"o","Œ":"o",r:"r","®":"r",R:"r","š":"s",s:"s","ß":"s","Š":"s",S:"s","ù":"u","ú":"u","û":"u","ü":"u",u:"u","Ù":"u","Ú":"u","Û":"u","Ü":"u",U:"u","ý":"y","ÿ":"y","Ý":"y","Ÿ":"y","ž":"z",z:"z","Ž":"z",Z:"z"};return t.replace(e,function(t){return o[t]})},n.replaceShortcodes=function(t){for(var e=n.replaceShortcodesEl.length,o=-1;(o+=1)<e;)t=n.replaceShortcodesEl[o](t);return t},n.restoreShortcodes=function(t){for(var e=n.restoreShortcodesEl.length,o=-1;(o+=1)<e;)t=n.restoreShortcodesEl[o](t);return t},n.replaceShortcodesEl=[function(t){return t.replace(/\[(?:ithoughts_tooltip_glossary-)?(glossary|tooltip|mediatip)(?!_)(.*?)\](.*?)\[\/(?:ithoughts_tooltip_glossary-)?(glossary|tooltip|mediatip)\]/g,function(t,e,o,i){for(var a,n={},r=/([\w\d\-]+?)="(.+?)"/g,s=null,l='<a data-type="'+p+"-"+{glossary:"term",tooltip:"tooltip",mediatip:"mediatip"}[e]+'"';Boolean(s=r.exec(o))===!0;)n[s[1]]=s[2];for(a in n)n.hasOwnProperty(a)&&(l+=u.indexOf(a)>-1||0===a.indexOf("data-")?" "+a+'="'+n[a]+'"':" data-"+a+'="'+n[a]+'"');return l+">"+i+"</a>"})},function(t){return t.replace(/\[glossary_(term_list|atoz)(.*?)\/\]/g,function(t,e,o){for(var i,a={},n=/([\w\d\-]+?)="(.+?)"/g,r=null,s='<span data-type="'+p+"-"+e+'"';Boolean(r=n.exec(o))===!0;)a[r[1]]=r[2];for(i in a)a.hasOwnProperty(i)&&(s+=u.indexOf(i)>-1||0===i.indexOf("data-")?" "+i+'="'+a[i]+'"':" data-"+i+'="'+a[i]+'"');return s+">Glossary "+("term_list"===e?"List":"A-to-Z")+"</span>"})}],n.restoreShortcodesEl=[function(t){return t.replace(/<a\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term|tooltip|mediatip)")(.*?)>(.*?)<\/a>/g,function(t,e,o,i){for(var a,n={},r=/(data-)?([\w\d\-]+?)="(.+?)"/g,s=null,p={term:"glossary",tooltip:"tooltip",mediatip:"mediatip"}[e],d="["+l+"-"+p;Boolean(s=r.exec(o))===!0;)"data-"===s[1]&&"type"===s[2]||(u.indexOf(s[2])>-1&&"undefined"!=typeof s[1]?n[s[1]+s[2]]=s[3]:n[s[2]]=s[3]);for(a in n)n.hasOwnProperty(a)&&(d+=" "+a+'="'+n[a]+'"');return d+"]"+i+"[/"+l+"-"+p+"]"})},function(t){return t.replace(/<span\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term_list|atoz)")(.*?)>.*?<\/span>/g,function(t,e,o){for(var i,a={},n=/(data-)?([\w\d\-]+?)="(.+?)"/g,r=null,s="[glossary_"+e;Boolean(r=n.exec(o))===!0;)"data-"===r[1]&&"type"===r[2]||(u.indexOf(i)>-1&&"undefined"!=typeof r[1]?a[r[1]+r[2]]=r[3]:a[r[2]]=r[3]);for(i in a)a.hasOwnProperty(i)&&(s+=" "+i+'="'+a[i]+'"');return s+"/]"})}],n.editorForms={list:function(e,a,r){function p(t){return(t||"").split(",").map(Function.prototype.call,String.prototype.trim).filter(function(t){return t})}n.log("Selection infos to load TIP: ",e);var l,d="insert_content",u=e.start,g={type:"atoz",alpha:[],group:[]};c(e.start)||e.start!==e.end||(n.log("Start & End node are the same, operating on a node of type "+u.nodeName),u&&"#text"!=u.nodeName&&(i.extend(g,{alpha:p(u.getAttribute("data-alpha")),group:p(u.getAttribute("data-group"))}),"ithoughts-tooltip-glossary-atoz"===u.getAttribute("data-type")?(d="load",g.type="atoz"):"ithoughts-tooltip-glossary-term_list"===u.getAttribute("data-type")&&(d="load",g.type="list",i.extend(g,{cols:parseInt(u.getAttribute("data-cols")),desc:u.getAttribute("data-desc")})))),l=t.makeLoader(),i.ajax({method:"POST",async:!0,url:n.admin_ajax,data:{action:s+"_get_tinymce_list_form",data:g},success:function(t){l.remove();var e=i(i.parseHTML(t,!0));i(document.body).append(e.css({opacity:0}).animate({opacity:1},500)),n.finishListTinymce=function(){var t=e;return function(e){if(n.info("New list data:",e),t.animate({opacity:0},500,function(){t.remove()}),"undefined"!=typeof e){var i="glossary_"+{atoz:"atoz",list:"term_list"}[e.type],r="load"!==d&&0===content.length?" ":"",s=[],p=function(t,e,i){s.push(o(t,e,i)),s=s.filter(function(t){return!c(t)})},l=["alpha","group"];switch(e.type){case"list":l=l.concat(["cols","desc"])}for(var u=0,g=l.length;g>u;u++){var m=l[u];e.hasOwnProperty(m)&&p(m,e[m])}var y="["+i+" "+s.join(" ")+"/]"+r;return n.log("Final content:",y),a(y,d)}}}()},error:function(){l.remove(),n.error("Error while getting TinyMCE form for Tip: ",arguments)}})},tip:function(e,a,p){n.info("Selection infos to load TIP: ",e);var u,g,m,y,f,h,_,v,x,w,O,q={},b=e.start,T=(i(b),""),S=-1;if(!c(e.start)&&e.start===e.end)if(n.log("Start & End node are the same, operating on a node of type "+b.nodeName),u=b&&b.text||e.html,n.log("Loading content: ",u),b&&"#text"!=b.nodeName&&d.indexOf(b.getAttribute("data-type"))>-1){for(T="load",y={},g=b.attributes,m=g.length;(S+=1)<m;)f=g[S],y[f.nodeName]=f.nodeValue;h=function(t,e){!c(e)&&e||(t="data-"+t);var o=y[t];return delete y[t],o},_=(h("position-at")||" ").split(" "),v=(h("position-my")||" ").split(" "),x=1===Math.max(v.indexOf("top"),v.indexOf("bottom"))||0===Math.max(v.indexOf("right"),v.indexOf("left")),_={1:_[0],2:_[1]},v={1:v[x?1:0],2:v[x?0:1],invert:x?"enabled":void 0},w=function(t){return"true"===t?!0:"false"===t?!1:null};var k=h("tooltip-content");p&&k&&(k=k.replace(/&lt;/g,"<").replace(/&gt;/g,">")),q={text:u,link:h("href",!0),tooltip_content:r(k||u,!1),glossary_id:h("glossary-id"),term_search:n.removeAccents(u.toLowerCase()),mediatip_type:h("mediatip-type"),mediatip_content:r(h("mediatip-content"),!1),mediatip_link:h("mediatip-link"),mediatip_caption:h("mediatip-caption"),type:["glossary","tooltip","mediatip"][d.indexOf(h("type"))],glossary_disable_auto_translation:"true"===(h("disable_auto_translation")||!1),opts:{termcontent:h("termcontent"),"qtip-keep-open":"true"===h("qtip-keep-open"),qtiprounded:w(h("qtiprounded")),qtipshadow:w(h("qtipshadow")),qtipstyle:h("qtipstyle"),qtiptrigger:h("qtiptrigger"),position:{at:_,my:v},attributes:{span:{},link:{}},anim:{"in":h("animation_in"),out:h("animation_out"),time:h("animation_time")},maxwidth:h("tooltip-maxwidth")}};for(S in y)y.hasOwnProperty(S)&&(S.match(/^data-link-/)?q.opts.attributes.link[S.replace(/^data-link-(data-)?/,"")]=y[S]:q.opts.attributes.span[S.replace(/^data-/,"")]=y[S])}else u&&u.length>0?(T="replace_content",q={text:u,link:"",tooltip_content:u,glossary_id:null,term_search:n.removeAccents(u.toLowerCase()),mediatip_type:"",mediatip_content:"",mediatip_caption:"",type:"tooltip",glossary_disable_auto_translation:!1}):(T="add_content",q={text:"",link:"",tooltip_content:"",glossary_id:null,term_search:"",mediatip_type:"",mediatip_content:"",mediatip_caption:"",type:"tooltip",glossary_disable_auto_translation:!1});O=t.makeLoader(),i.ajax({method:"POST",async:!0,url:n.admin_ajax,data:{action:s+"_get_tinymce_tooltip_form",data:q},success:function(t){O.remove();var e=i(i.parseHTML(t,!0));i(document.body).append(e.css({opacity:1}).animate({opacity:1},500)),n.finishTipTinymce=function(){var t=e;return function(e){if(n.info("New tooltip data:",e),t.animate({opacity:0},500,function(){t.remove()}),"undefined"!=typeof e){var i,r,s,d,g=t.find("#attributes-list option").map(function(){return this.value}).toArray(),m=[],y=e.opts||q.opts,f=function(t,e,i){m.push(o(t,e,i)),m=m.filter(function(t){return!c(t)})},h=["span","link"],_=h.length,v=-1,x=y&&y.attributes||{},w=l+"-"+e.type,O="load"!==T&&0===u.length?" ":"";if(!c(y))for(y["qtip-content"]&&f("data-termcontent",y["qtip-content"]),y["qtip-keep-open"]&&f("data-qtip-keep-open","true"),c(y.qtiprounded)||f("data-qtiprounded",String(y.qtiprounded)),c(y.qtipshadow)||f("data-qtipshadow",String(y.qtipshadow)),y.qtipstyle&&f("data-qtipstyle",y.qtipstyle),y.qtiptrigger&&f("data-qtiptrigger",y.qtiptrigger),y.position&&(y.position.at&&y.position.at[1]&&y.position.at[2]&&f("data-position-at",y.position.at[1]+" "+y.position.at[2]),y.position.my&&y.position.my[1]&&y.position.my[2]&&(i=[y.position.my[1],y.position.my[2]],y.position.my.invert&&i.reverse(),f("data-position-my",i.join(" ")))),y.anim&&(y.anim["in"]&&f("data-animation_in",y.anim["in"]),y.anim.out&&f("data-animation_out",y.anim.out),y.anim.time&&f("data-animation_time",y.anim.time)),y.maxwidth&&f("data-tooltip-maxwidth",y.maxwidth);v++<_;){var b=h[v];if(x.hasOwnProperty(b))for(r in x[b])x[b].hasOwnProperty(r)&&(s=g.indexOf(r)>-1&&!r.startsWith("data-")?"":"data-",d="link"===b?"link-":"",f(s+d+r,x[b][r],!0))}if(e.link&&f("href",encodeURI(e.link)),"glossary"===e.type){if(!e.glossary_id||!e.text)return;f("glossary-id",e.glossary_id),e.disable_auto_translation&&f("disable_auto_translation","true")}else if("tooltip"===e.type){if(!e.tooltip_content||!e.text)return;f("tooltip-content",p?e.tooltip_content.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e.tooltip_content,!0)}else if("mediatip"===e.type){if(!(e.mediatip_type&&e.mediatip_content&&e.text))return;f("mediatip-type",e.mediatip_type),f("mediatip-content",e.mediatip_content,!0),e.mediatip_caption&&f("mediatip-caption",e.mediatip_caption,!0)}var S="["+w+" "+m.join(" ")+"]"+e.text+"[/"+w+"]"+O;return n.log("Final content:",S),a(S,T)}}}()},error:function(){O.remove(),n.error("Error while getting TinyMCE form for Tip: ",arguments)}})}},QTags.addButton("ithoughts_tt_gl-tip","ITG Tip",function(){n.editorForms.tip(e(),QTags.insertContent,!0)}),QTags.addButton("ithoughts_tt_gl-list","ITG List",function(){n.editorForms.list(e(),QTags.insertContent,!0)})})}(Ithoughts.v4);