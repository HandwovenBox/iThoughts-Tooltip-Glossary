/**
 * @file Interface between plugin formatted data and qTip API
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package ithoughts-tooltip-glossary
 *
 */
ithoughts_tt_gl=ithoughts_tt_gl||{},function(t){"use strict";function i(t){var i=o(document.createElement("div"));o(i).append(o(t));var i=i.html();return i}function e(e){for(var n=s.height(),a=s.width(),r=0,d=[[512,288],[256,144]],p=d.length;p>r&&!(a>d[r][0]&&n>d[r][1]);r++);r=Math.min(d.length,Math.max(0,r));var l=d[r];if("undefined"==typeof e&&"undefined"!=typeof l)o(".ithoughts_tt_gl-video").prop({width:l[0],height:l[1]}),o(".ithoughts_tt_gl-video_tip").each(function(){var t=o(this).qtip("api"),i=t.disabled;t.enable(),t.reposition(),t.disable(i)}).css({width:l[0],height:l[1]});else if(!t.isNA(e))return e.prop({width:l[0],height:l[1]}).addClass("ithoughts_tt_gl-video"),{dims:{width:l[0],height:l[1]},text:i(e)}}var n,a,o=t.$,s=t.$w,r=t.$d,d=ithoughts_tt_gl,p=t.isNA,l=o.extend,c="ithoughts_tooltip_glossary";t.initLoggers(d,"iThoughts Tooltip Glossary",d.verbosity),d.stripQuotes=function(t,i){return"string"!=typeof t?"":i?t.replace(/"/g,"&aquot;").replace(/\n/g,"<br/>"):t.replace(/<br\/>/g,"\n").replace(/&aquot;/g,'"')},d.doInitTooltips=function(){p(n)&&(n=o(o.parseHTML('<div id="'+c+'-tipsContainer"></div>')),o(document.body).append(n));var i={start:t.isIos?"mousedown":"touchstart",end:t.isIos?"mouseup":"touchend"};t.isIos&&o("body").css({cursor:"pointer"}),o("span[class^="+c+"-]").each(function(){var a=o(this),s=a.data("qtipstyle")||d.qtipstyle,r=a.data("termcontent")||d.termcontent,p=a.data("qtipshadown")||d.qtipshadown,u=a.data("qtiprounded")||d.qtiprounded,m=a.data("qtiptrigger")||d.qtiptrigger,h=a.data("animation_in")||d.anims["in"],f=a.data("animation_out")||d.anims.out,g=a.data("animation_time")||d.anims.duration,v=[];p="true"===p||"1"===p,u="true"===u||"1"===u,"click"==m?a.children("a").click(function(t){1!=a.touch&&(t.preventDefault(),a.touch=1)}).mouseleave(function(){a.touch=0}):"responsive"==m&&(a.touch=t.baseTouch,o("body").bind("click touch",function(t){0==o(t.target).closest(a).length&&(a.data("expanded",!1),a.triggerHandler("responsiveout"))}),a.children("a").click(function(t){a.data("expanded")||0==a.touch||(a.data("expanded",!0),a.triggerHandler("responsive"),t.preventDefault())}).bind(i.start,function(t){a.touch=1}).bind(i.end,function(t){a.touch=2}).bind("mouseover focus",function(t){a.triggerHandler("responsive")}).bind("mouseleave focusout",function(t){a.triggerHandler("responsiveout")}));var _;_=a.data("qtipstyle")?"qtip-"+a.data("qtipstyle")+(p?" qtip-shadow":"")+(u?" qtip-rounded":"")+" ":a.data("tooltip-classes")?a.data("tooltip-classes"):"qtip-"+s+(p?" qtip-shadow":"")+(u?" qtip-rounded":"")+" ";var y,w,x={};if(a.hasClass(c+"-glossary"))if(d.info("Do init a GLOSSARYTIP"),a.data("termid")&&"off"!=r){var q={action:"ithoughts_tt_gl_get_term_details",content:r,termid:a.data().termid};"true"==a.data("disable_auto_translation")&&(q.disable_auto_translation=!0),w={content:{text:d.lang.qtip.pleasewait_ajaxload.content,ajax:{url:d.admin_ajax,type:"POST",data:q,dataType:"json",loading:!1,success:function(t,i){t.success?(this.set("content.title",t.data.title),this.set("content.text",t.data.content)):this.set("content.text","Error")}},title:{text:d.lang.qtip.pleasewait_ajaxload.title}},style:{classes:_+c+"-glossary"}}}else a.data("term-content")&&a.data("term-title")&&(w={content:{title:{text:a.data("term-title")},text:a.data("term-content")},style:{classes:_+c+"-glossary"}});else if(a.hasClass(c+"-tooltip"))d.info("Do init a TOOLTIP"),w={style:{classes:_+c+"-tooltip"},content:{text:d.stripQuotes(a.data("tooltip-content"),!1),title:{text:a.text()}}};else{if(!a.hasClass(c+"-mediatip"))return;if(d.info("Do init a MEDIATIP"),w={style:{classes:_+c+"-mediatip"},position:{adjust:{scroll:!1}},content:{text:"",title:{text:a.text()}},events:{show:function(){a.qtip().reposition()}}},a.data("mediatip-image")){var b={src:a.data("mediatip-image"),alt:a.text()};if("undefined"!=typeof d.qtip_filters&&d.qtip_filters&&"undefined"!=typeof d.qtip_filters.mediatip&&d.qtip_filters.mediatip&&d.qtip_filters.mediatip.length>0)for(var k=0;k<d.qtip_filters.mediatip.length;k++)b=l(b,d.qtip_filters.mediatip[k](a));var I="";for(var T in b)I+=T+'="'+b[T]+'" ';w.content.text="<img "+I+">";var z=a.data("mediatip-caption");z&&(w.content.text+='<div class="ithoughts_tt_gl-caption">'+z.replace(/&aquot;/g,'"')+"</div>")}else if(a.data("mediatip-html")){var H=function(t){return 1==t.length&&("IFRAME"==t[0].nodeName&&t[0].src.match(/youtube|dailymotion/)||"VIDEO"==t[0].nodeName)?e(t):void 0}(o(o.parseHTML(a.data("mediatip-html").replace("&quot;",'"').trim())));v.push(function(t,i){i.elements.title.find("."+c+"_pin_container").click(function(){o(this).toggleClass("pined").hasClass("pined")?i.disable():i.enable()})}),l(!0,w,{content:{text:H.text,title:{text:'<span class="'+c+'_pin_container"><svg viewBox="0 0 26 26" class="'+c+'_pin"><use xlink:href="#icon-pin"></use></svg></span><span class="ithoughts_tt_gl-title_with_pin">'+w.content.title.text+"</span>"}},style:{width:H.dims.width}}),y.style.classes+=" ithoughts_tt_gl-force_no_pad ithoughts_tt_gl-video_tip ithoughts_tt_gl-with_pin"}}"true"==a.data("tooltip-autoshow")&&l(!0,x,{show:{ready:!0}}),"true"==a.data("tooltip-nosolo")&&l(!0,x,{show:{solo:!1}}),"true"==a.data("tooltip-nohide")&&l(!0,x,{hide:"someevent",show:{event:"someevent"}}),a.data("tooltip-id")&&l(!0,x,{id:a.data("tooltip-id")}),(a.data("qtip-keep-open")||a.hasClass(c+"-mediatip"))&&l(!0,x,{hide:{fixed:!0,delay:250}}),1==a.data("tooltip-prerender")&&l(!0,x,{prerender:!0}),y={prerender:!1,suppress:!1,position:{at:a.data("position-at")||"top center",my:a.data("position-my")||"bottom center",viewport:o("body"),effect:!1,container:n},show:{event:m,solo:!0,effect:d.animationFunctions["in"][h]||d.animationFunctions["in"].none},hide:{event:"responsive"==m?"responsiveout":"mouseleave",leave:!1,effect:d.animationFunctions.out[f]||d.animationFunctions["in"].none},events:{render:function(t,i){o(this).css({maxWidth:a.data("tooltip-maxwidth")}),o(this).prop("animation_duration",g);for(var e=0,n=v.length;n>e;e++)v[e](t,i);if(d.renderHooks)for(var e=0,n=d.renderHooks.length;n>e;e++)d.renderHooks[e](t,i)}},style:_};var C=l(!0,y,w,x);a.qtip(C),a.find("a[title]").removeAttr("title")})},s.resize(function(){clearTimeout(a),a=setTimeout(e,100)}),r.ready(function(){d.doInitTooltips()}),l(o.easing,{easeInBack:function(t,i,e,n,a,o){return void 0==o&&(o=1.70158),n*(i/=a)*i*((o+1)*i-o)+e},easeOutBack:function(t,i,e,n,a,o){return void 0==o&&(o=1.70158),n*((i=i/a-1)*i*((o+1)*i+o)+1)+e}}),d.animationFunctions=l(!0,d.animationFunctions,{"in":{none:function(){o(this).show()},zoomin:function(t){var i=o(this),e=t.elements.tip;i.prop("scale_start",i.prop("scale")||0),i.show().animate({z:1},{progress:function(t,n,a){var s=o.easing.swing(n,t.duration-a,0,1,t.duration),r=i.prop("scale_start")*(1-s),d=1*s,p=r+d;1!=p&&0!=p&&i.prop("scale",p);var l="scale("+p+")",c=e.css(["left","top"]);c=c.left+" "+c.top+" 0",i.css({"-webkit-transform":l,"-moz-transform":l,transform:l,"-ms-transform-origin":c,"-webkit-transform-origin":c,"transform-origin":c})},duration:i.prop("animation_duration"),done:function(t,e){!p(e)&&e||(i.prop("scale",null),i.css({"-webkit-transform":"","-moz-transform":"",transform:"","-ms-transform-origin":"","-webkit-transform-origin":"","transform-origin":""}))}})},appear:function(){var t=o(this);t.css({display:"block",opacity:0}).animate({opacity:1},{easing:"swing",duration:t.prop("animation_duration")})}},out:{none:function(){},unhook:function(){var t=o(this);t.animate({opacity:0,top:"+=50"},{easing:"easeInBack",duration:t.prop("animation_duration")})},flee:function(){var t=o(this);t.animate({opacity:0,left:-100},{easing:"easeInBack",duration:t.prop("animation_duration")})},zoomout:function(t){var i=o(this),e=t.elements.tip;i.prop("scale_start",i.prop("scale")||1),i.animate({z:1},{progress:function(t,n,a){var s=o.easing.swing(n,t.duration-a,0,1,t.duration),r=i.prop("scale_start")*(1-s),d=0,p=r+d;1!=p&&0!=p&&i.prop("scale",p);var l="scale("+p+")",c=e.css(["left","top"]);c=c.left+" "+c.top+" 0",i.css({"-webkit-transform":l,"-moz-transform":l,transform:l,"-ms-transform-origin":c,"-webkit-transform-origin":c,"transform-origin":c})},duration:i.prop("animation_duration"),done:function(t,e){!p(e)&&e||(i.prop("scale",null),i.css({"-webkit-transform":"","-moz-transform":"",transform:"","-ms-transform-origin":"","-webkit-transform-origin":"","transform-origin":""}))}})},disappear:function(){var t=o(this);t.animate({opacity:0},{easing:"swing",duration:t.prop("animation_duration")})}}})}(Ithoughts.v4);