/**
 * @file TinyMCE plugin scripts
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license http://www.gnu.org/licenses/old-licenses/gpl-2.0.fr.html GPLv2
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.5.0
 */
!function(t){"use strict";function e(t,e){return function(){var o=this;e.on(t,function(t){o.active(t.active)})}}function o(e){for(var o=t.replaceShortcodesEl.length,n=-1;(n+=1)<o;)e=t.replaceShortcodesEl[n](e);return e}function n(e){for(var o=t.restoreShortcodesEl.length,n=-1;(n+=1)<o;)e=t.restoreShortcodesEl[n](e);return e}var r=t.$,i=ithoughts_tt_gl,s=ithoughts_tt_gl_editor,a="ithoughts_tt_gl",l=a+"_tinymce",c="ithoughts-tooltip-glossary",g="ithoughts_tooltip_glossary",d=(i.stripQuotes,t.isNA,["href"]),u=["ithoughts-tooltip-glossary-term","ithoughts-tooltip-glossary-tooltip","ithoughts-tooltip-glossary-mediatip"],p=u.map(function(t){return'[data-type="'+t+'"]'}).join(",");tinymce.PluginManager.add(l,function(t,i){function g(e){var o=t.selection.getNode(),n=r(o),i=n.closest(p),s=i.get(0);if(s){var a=s.innerHTML;i.replaceWith(a)}}function d(){console.log(t.selection.getRng());var e={DOM:r(t.selection.getNode()).closest(p).toArray()};return e.html=r(e.DOM).prop("outerHTML"),e.start=t.selection.getStart(),e.end=t.selection.getEnd(),e}t.contentCSS.push(i+"/../css/"+a+"-admin.css?v=2.1.7"),t.on("BeforeSetcontent",function(t){t.content=o(t.content)}).on("GetContent",function(t){t.content=n(t.content)}).on("NodeChange",function(e){var o=e.element;r(o).closest(p).length>0?(t.fire("glossaryterm",{active:!0}),t.fire("glossaryterm-d",{active:!0})):(t.fire("glossaryterm",{active:!1}),t.fire("glossaryterm-d",{active:!1})),-1!==[c+"-term_list",c+"-atoz"].indexOf(o.getAttribute("data-type"))?t.fire("glossarylist",{active:!0}):t.fire("glossarylist",{active:!1})}),t.addButton("glossaryterm",{title:t.getLang(l+".add_tooltip"),image:i+"/icon/glossaryterm.png",onPostRender:e("glossaryterm",t),onclick:function(){s.editorForms.tip(d(),function(e){t.insertContent(e)})}}),t.addButton("glossaryterm-d",{title:t.getLang(l+".remove_tooltip"),image:i+"/icon/glossaryterm-d.png",onPostRender:e("glossaryterm-d",t),onclick:g});t.addButton("glossarylist",{title:t.getLang(l+".add_index"),image:i+"/icon/glossaryindex.png",onPostRender:e("glossarylist",t),onclick:function(){var e={selection:t.selection};e.start=e.selection.getStart(),e.end=e.selection.getEnd(),e.DOM=r.parseHTML(e.selection),s.editorForms.list(d(),function(e){t.insertContent(e)})}})}),t.replaceShortcodesEl=[function(t){return t.replace(/\[(?:ithoughts_tooltip_glossary-)?(glossary|tooltip|mediatip)(?!_)(.*?)\](.*?)\[\/(?:ithoughts_tooltip_glossary-)?(glossary|tooltip|mediatip)\]/g,function(t,e,o,n){for(var r,i={},s=/([\w\d\-]+?)="(.+?)"/g,a=null,l='<a data-type="'+c+"-"+{glossary:"term",tooltip:"tooltip",mediatip:"mediatip"}[e]+'"';Boolean(a=s.exec(o))===!0;)i[a[1]]=a[2];for(r in i)i.hasOwnProperty(r)&&(l+=d.indexOf(r)>-1||0===r.indexOf("data-")?" "+r+'="'+i[r]+'"':" data-"+r+'="'+i[r]+'"');return l+">"+n+"</a>"})},function(t){return t.replace(/\[glossary_(term_list|atoz)(.*?)\/\]/g,function(t,e,o){for(var n,r={},i=/([\w\d\-]+?)="(.+?)"/g,s=null,a='<span data-type="'+c+"-"+e+'"';Boolean(s=i.exec(o))===!0;)r[s[1]]=s[2];for(n in r)r.hasOwnProperty(n)&&(a+=d.indexOf(n)>-1||0===n.indexOf("data-")?" "+n+'="'+r[n]+'"':" data-"+n+'="'+r[n]+'"');return a+">Glossary "+("term_list"===e?"List":"A-to-Z")+"</span>"})}],t.restoreShortcodesEl=[function(t){return t.replace(/<a\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term|tooltip|mediatip)")(.*?)>(.*?)<\/a>/g,function(t,e,o,n){for(var r,i={},s=/(data-)?([\w\d\-]+?)="(.+?)"/g,a=null,l={term:"glossary",tooltip:"tooltip",mediatip:"mediatip"}[e],c="["+g+"-"+l;Boolean(a=s.exec(o))===!0;)"data-"===a[1]&&"type"===a[2]||(d.indexOf(a[2])>-1&&"undefined"!=typeof a[1]?i[a[1]+a[2]]=a[3]:i[a[2]]=a[3]);for(r in i)i.hasOwnProperty(r)&&(c+=" "+r+'="'+i[r]+'"');return c+"]"+n+"[/"+g+"-"+l+"]"})},function(t){return t.replace(/<span\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term_list|atoz)")(.*?)>.*?<\/span>/g,function(t,e,o){for(var n,r={},i=/(data-)?([\w\d\-]+?)="(.+?)"/g,s=null,a="[glossary_"+e;Boolean(s=i.exec(o))===!0;)"data-"===s[1]&&"type"===s[2]||(d.indexOf(n)>-1&&"undefined"!=typeof s[1]?r[s[1]+s[2]]=s[3]:r[s[2]]=s[3]);for(n in r)r.hasOwnProperty(n)&&(a+=" "+n+'="'+r[n]+'"');return a+"/]"})}]}(Ithoughts.v4);