/**
 * @file TinyMCE plugin scripts
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license http://www.gnu.org/licenses/old-licenses/gpl-2.0.fr.html GPLv2
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.5.0
 */
!function(t){"use strict";function e(t,e){return function(){var i=this;e.on(t,function(t){i.active(t.active)})}}function i(e){for(var i=t.replaceShortcodesEl.length,o=-1;(o+=1)<i;)e=t.replaceShortcodesEl[o](e);return e}function o(e){for(var i=t.restoreShortcodesEl.length,o=-1;(o+=1)<i;)e=t.restoreShortcodesEl[o](e);return e}var a=t.$,n=t.$w,r=ithoughts_tt_gl,l="ithoughts_tt_gl",s=l+"_tinymce",p="ithoughts-tooltip-glossary",d="ithoughts_tooltip_glossary",g=r.stripQuotes,c=t.isNA,u=/[¹²³áàâãäåaaaÀÁÂÃÄÅAAAÆccç©CCÇÐÐèéê?ëeeeeeÈÊË?EEEEE€gGiìíîïìiiiÌÍÎÏ?ÌIIIlLnnñNNÑòóôõöoooøÒÓÔÕÖOOOØŒr®Ršs?ßŠS?ùúûüuuuuÙÚÛÜUUUUýÿÝŸžzzŽZZ]/g,m={"¹":"1","²":"2","³":"3","á":"a","à":"a","â":"a","ã":"a","ä":"a","å":"a",a:"a","À":"a","Á":"a","Â":"a","Ã":"a","Ä":"a","Å":"a",A:"a","Æ":"a",c:"c","ç":"c","©":"c",C:"c","Ç":"c","Ð":"d","è":"e","é":"e","ê":"e","?":"s","ë":"e",e:"e","È":"e","Ê":"e","Ë":"e",E:"e","€":"e",g:"g",G:"g",i:"i","ì":"i","í":"i","î":"i","ï":"i","Ì":"i","Í":"i","Î":"i","Ï":"i",I:"i",l:"l",L:"l",n:"n","ñ":"n",N:"n","Ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o",o:"o","ø":"o","Ò":"o","Ó":"o","Ô":"o","Õ":"o","Ö":"o",O:"o","Ø":"o","Œ":"o",r:"r","®":"r",R:"r","š":"s",s:"s","ß":"s","Š":"s",S:"s","ù":"u","ú":"u","û":"u","ü":"u",u:"u","Ù":"u","Ú":"u","Û":"u","Ü":"u",U:"u","ý":"y","ÿ":"y","Ý":"y","Ÿ":"y","ž":"z",z:"z","Ž":"z",Z:"z"},y=["href"],f=["ithoughts-tooltip-glossary-term","ithoughts-tooltip-glossary-tooltip","ithoughts-tooltip-glossary-mediatip"],h=f.map(function(t){return'[data-type="'+t+'"]'}).join(",");r.removeAccents=function(t){return t.replace(u,function(t){return m[t]})},tinymce.PluginManager.add(s,function(t,u){function m(e){var i,o="insert_content",a={list:{alpha:"",cols:"",desc:"",group:""},atoz:{group:"",alpha:"",lazy:!0},type:0},n=t.selection,r=n.getStart();r===n.getEnd()&&("ithoughts-tooltip-glossary-atoz"===r.getAttribute("data-type")?(o="load",a.type=1,a.atoz={alpha:r.getAttribute("data-alpha"),group:r.getAttribute("data-group"),lazy:"true"===r.getAttribute("data-lazy")}):"ithoughts-tooltip-glossary-term_list"===r.getAttribute("data-type")&&(o="load",a.type=0,a.list={alpha:r.getAttribute("data-alpha"),cols:r.getAttribute("data-cols"),desc:r.getAttribute("data-desc"),group:r.getAttribute("data-group")})),i=a.type,t.windowManager.open({title:t.getLang(s+".insert_index"),margin:"0 0 0 0",padding:"0 0 0 0",border:"0 0 0 0",body:[new tinyMCE.ui.TabPanel({margin:"0 0 0 0",padding:"0 0 0 0",border:"0 0 0 0",onclick:function(t){try{t.target.id.match(/^mceu_\d+-t(\d+)$/)&&(i=t.target.id.replace(/^mceu_\d+-t(\d+)$/,"$1"))}catch(e){}},items:[new tinyMCE.ui.Factory.create({type:"form",title:t.getLang(s+".list"),items:[{type:"textbox",label:t.getLang(s+".letters"),name:"ll",value:a.list.alpha,tooltip:t.getLang(s+".letters_explain")},{type:"textbox",label:t.getLang(s+".columns"),name:"lc",value:a.list.cols,tooltip:t.getLang(s+".columns_explain")},{type:"listbox",label:t.getLang(s+".description"),name:"ld",values:[{text:"None",value:""},{text:t.getLang(s+".excerpt"),value:"excerpt"},{text:t.getLang(s+".full"),value:"full"},{text:t.getLang(s+".glossarytips"),value:"glossarytips"}],value:a.list.desc,tooltip:t.getLang(s+".description_explain")},{type:"textbox",label:t.getLang(s+".group"),name:"lg",value:a.list.group,tooltip:t.getLang(s+".group_explain")}]}),new tinyMCE.ui.Factory.create({type:"form",title:t.getLang(s+".atoz"),items:[{type:"textbox",label:t.getLang(s+".letters"),name:"al",value:a.atoz.alpha,tooltip:t.getLang(s+".letters_explain")},{type:"textbox",label:t.getLang(s+".group"),name:"ag",value:a.atoz.group,tooltip:t.getLang(s+".group_explain")}]})],activeTab:a.type})],onsubmit:function(e){"load"===o&&n.select(n.getStart());var a,r=parseInt(i,10),l=e.data;0===r?(a=[],l.ll&&a.push('alpha="'+g(l.ll,!0)+'"'),l.lg&&a.push('group="'+g(l.lg,!0)+'"'),l.lc&&a.push('cols="'+g(l.lc,!0)+'"'),l.ld&&a.push('desc="'+g(l.ld,!0)+'"'),t.insertContent("[glossary_term_list"+(a.length>0?" "+a.join(" "):"")+" /]")):1===r&&(a=[],l.al&&a.push('alpha="'+g(l.al,!0)+'"'),l.ag&&a.push('group="'+g(l.ag,!0)+'"'),t.insertContent("[glossary_atoz"+(a.length>0?" "+a.join(" "):"")+" /]"))}})}function y(e){var i,o,s,p,u,m,y,_,x,v,b={},w=t.selection,L=a(w.getNode()).closest(h),q=L.get(0),O="",k=-1;if(w.getStart()===w.getEnd())if(i=q&&q.text||w.getContent(),q&&f.indexOf(q.getAttribute("data-type"))>-1){for(O="load",p={},o=q.attributes,s=o.length;(k+=1)<s;)u=o[k],p[u.nodeName]=u.nodeValue;m=function(t,e){!c(e)&&e||(t="data-"+t);var i=p[t];return delete p[t],i},y=(m("position-at")||" ").split(" "),_=(m("position-my")||" ").split(" "),x=1===Math.max(_.indexOf("top"),_.indexOf("bottom"))||0===Math.max(_.indexOf("right"),_.indexOf("left")),y={1:y[0],2:y[1]},_={1:_[x?1:0],2:_[x?0:1],invert:x?"enabled":void 0},v=function(t){return"true"===t?!0:"false"===t?!1:null},b={text:i,link:m("href",!0),tooltip_content:g(m("tooltip-content")||i,!1),glossary_id:m("glossary-id"),term_search:r.removeAccents(i.toLowerCase()),mediatip_type:m("mediatip-type"),mediatip_content:g(m("mediatip-content"),!1),mediatip_link:m("mediatip-link"),mediatip_caption:m("mediatip-caption"),type:["glossary","tooltip","mediatip"][f.indexOf(m("type"))],glossary_disable_auto_translation:"true"===(m("disable_auto_translation")||!1),opts:{termcontent:m("termcontent"),"qtip-keep-open":"true"===m("qtip-keep-open"),qtiprounded:v(m("qtiprounded")),qtipshadow:v(m("qtipshadow")),qtipstyle:m("qtipstyle"),qtiptrigger:m("qtiptrigger"),position:{at:y,my:_},attributes:{span:{},link:{}},anim:{"in":m("animation_in"),out:m("animation_out"),time:m("animation_time")},maxwidth:m("tooltip-maxwidth")}};for(k in p)p.hasOwnProperty(k)&&(k.match(/^data-link-/)?b.opts.attributes.link[k.replace(/^data-link-/,"")]=p[k]:b.opts.attributes.span[k.replace(/^data-/,"")]=p[k])}else i&&i.length>0?(O="replace_content",b={text:i,link:"",tooltip_content:i,glossary_id:null,term_search:r.removeAccents(i.toLowerCase()),mediatip_type:"",mediatip_content:"",mediatip_caption:"",type:"tooltip",glossary_disable_auto_translation:!1}):(O="add_content",b={text:"",link:"",tooltip_content:"",glossary_id:null,term_search:r.removeAccents(i.toLowerCase()),mediatip_type:"",mediatip_content:"",mediatip_caption:"",type:"tooltip",glossary_disable_auto_translation:!1});a.ajax({method:"POST",async:!0,url:r.admin_ajax,data:{action:l+"_get_tinymce_tooltip_form",data:b},success:function(e){var o=a(a.parseHTML(e,!0)),s=400,p=455,u=o.find("#"+l+"-tooltip-form"),m=o.find("#"+l+"-tooltip-form-options");n.on("resize",function(){var t={width:p+"px",height:s+"px",left:(n.width()-p)/2+"px",top:(n.height()-s)/2+"px"};u.css(t),m.css(t)}).resize(),a(document.body).append(o.css({opacity:0}).animate({opacity:1},500)),r.finishTinymce=function(){var e=o;return function(o){if(e.animate({opacity:0},500,function(){e.remove()}),"undefined"!=typeof o){var a,n,r,l,s=e.find("#attributes-list option").map(function(){return this.value}).toArray(),p=[],u=o.opts||b.opts,m=function(t,e,i){return e=String(e).trim(),t.match(/^[\w_\-]*$/)?g(t.trim(),!0)+'="'+(!c(i)&&i?e.replace(/"/g,"&aquot;").replace(/\n/g,"<br/>"):g(e,!0))+'"':null},y=function(t,e,i){p.push(m(t,e,i)),p=p.filter(function(t){return!c(t)})},f=["span","link"],h=f.length,_=-1,x=u&&u.attributes||{},v=d+"-"+o.type,L="load"!==O&&0===i.length?" ":"";if("load"===O?w.select(w.getStart()):O.indexOf("extend")>-1&&console.warn("Unhandled"),!c(u))for(u["qtip-content"]&&y("data-termcontent",u["qtip-content"]),u["qtip-keep-open"]&&y("data-qtip-keep-open","true"),c(u.qtiprounded)||y("data-qtiprounded",String(u.qtiprounded)),c(u.qtipshadow)||y("data-qtipshadow",String(u.qtipshadow)),u.qtipstyle&&y("data-qtipstyle",u.qtipstyle),u.qtiptrigger&&y("data-qtiptrigger",u.qtiptrigger),u.position&&(u.position.at&&u.position.at[1]&&u.position.at[2]&&y("data-position-at",u.position.at[1]+" "+u.position.at[2]),u.position.my&&u.position.my[1]&&u.position.my[2]&&(a=[u.position.my[1],u.position.my[2]],u.position.my.invert&&a.reverse(),y("data-position-my",a.join(" ")))),u.anim&&(u.anim["in"]&&y("data-animation_in",u.anim["in"]),u.anim.out&&y("data-animation_out",u.anim.out),u.anim.time&&y("data-animation_time",u.anim.time)),u.maxwidth&&y("data-tooltip-maxwidth",u.maxwidth);(_+=1)<h;)if(x.hasOwnProperty(_))for(n in x[f[_]])x[f[_]].hasOwnProperty(n)&&(r=s.indexOf(n)>-1?"":"data-",l="link"===f[_]?"link-":"",y(r+l+n,x[f[_]][n],!0));if(o.link&&y("href",encodeURI(o.link)),"glossary"===o.type){if(!o.term_id||!o.text)return;y("glossary-id",o.glossary_id),o.disable_auto_translation&&y("disable_auto_translation","true"),t.insertContent("["+v+" "+p.join(" ")+"]"+o.text+"[/"+v+"]"+L)}else if("tooltip"===o.type){if(!o.tooltip_content||!o.text)return;y("tooltip-content",o.tooltip_content,!0),t.insertContent("["+v+" "+p.join(" ")+"]"+o.text+"[/"+v+"]"+L)}else if("mediatip"===o.type){if(!(o.mediatip_type&&o.mediatip_content&&o.text))return;y("mediatip-type",o.mediatip_type),y("mediatip-content",o.mediatip_content,!0),y("mediatip-link",o.mediatip_link),o.mediatip_caption&&y("mediatip-caption",o.mediatip_caption,!0),t.insertContent("["+v+" "+p.join(" ")+"]"+o.text+"[/"+v+"]"+L)}}}}()},error:function(){console.error("Error while getting TinyMCE form.",arguments)}})}function _(e){var i=t.selection.getNode(),o=a(i),n=o.closest(h),r=n.get(0);if(r){var l=r.innerHTML;n.replaceWith(l)}}t.contentCSS.push(u+"/../css/"+l+"-admin.css?v=2.1.7"),t.on("BeforeSetcontent",function(t){t.content=i(t.content)}).on("GetContent",function(t){t.content=o(t.content)}).on("NodeChange",function(e){var i=e.element;a(i).closest(h).length>0?(t.fire("glossaryterm",{active:!0}),t.fire("glossaryterm-d",{active:!0})):(t.fire("glossaryterm",{active:!1}),t.fire("glossaryterm-d",{active:!1})),-1!==[p+"-term_list",p+"-atoz"].indexOf(i.getAttribute("data-type"))?t.fire("glossarylist",{active:!0}):t.fire("glossarylist",{active:!1})}),t.addButton("glossaryterm",{title:t.getLang(s+".add_tooltip"),image:u+"/icon/glossaryterm.png",onclick:y,onPostRender:e("glossaryterm",t)}),t.addButton("glossaryterm-d",{title:t.getLang(s+".remove_tooltip"),image:u+"/icon/glossaryterm-d.png",onclick:_,onPostRender:e("glossaryterm-d",t)});t.addButton("glossarylist",{title:t.getLang(s+".add_index"),image:u+"/icon/glossaryindex.png",onPostRender:e("glossarylist",t),onclick:m})}),t.replaceShortcodesEl=[function(t){return t.replace(/\[(?:ithoughts_tooltip_glossary-)?(glossary|tooltip|mediatip)(?!_)(.*?)\](.*?)\[\/(?:ithoughts_tooltip_glossary-)?(glossary|tooltip|mediatip)\]/g,function(t,e,i,o){for(var a,n={},r=/([\w\d\-]+?)="(.+?)"/g,l=null,s='<a data-type="'+p+"-"+{glossary:"term",tooltip:"tooltip",mediatip:"mediatip"}[e]+'"';Boolean(l=r.exec(i))===!0;)n[l[1]]=l[2];for(a in n)n.hasOwnProperty(a)&&(s+=y.indexOf(a)>-1||0===a.indexOf("data-")?" "+a+'="'+n[a]+'"':" data-"+a+'="'+n[a]+'"');return s+">"+o+"</a>"})},function(t){return t.replace(/\[glossary_(term_list|atoz)(.*?)\/\]/g,function(t,e,i){for(var o,a={},n=/([\w\d\-]+?)="(.+?)"/g,r=null,l='<span data-type="'+p+"-"+e+'"';Boolean(r=n.exec(i))===!0;)a[r[1]]=r[2];for(o in a)a.hasOwnProperty(o)&&(l+=y.indexOf(o)>-1||0===o.indexOf("data-")?" "+o+'="'+a[o]+'"':" data-"+o+'="'+a[o]+'"');return l+">Glossary "+("term_list"===e?"List":"A-to-Z")+"</span>"})}],t.restoreShortcodesEl=[function(t){return t.replace(/<a\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term|tooltip|mediatip)")(.*?)>(.*?)<\/a>/g,function(t,e,i,o){for(var a,n={},r=/(data-)?([\w\d\-]+?)="(.+?)"/g,l=null,s={term:"glossary",tooltip:"tooltip",mediatip:"mediatip"}[e],p="["+d+"-"+s;Boolean(l=r.exec(i))===!0;)"data-"===l[1]&&"type"===l[2]||(y.indexOf(l[2])>-1&&"undefined"!=typeof l[1]?n[l[1]+l[2]]=l[3]:n[l[2]]=l[3]);for(a in n)n.hasOwnProperty(a)&&(p+=" "+a+'="'+n[a]+'"');return p+"]"+o+"[/"+d+"-"+s+"]"})},function(t){return t.replace(/<span\s+(?=[^>]*data-type="ithoughts-tooltip-glossary-(term_list|atoz)")(.*?)>.*?<\/span>/g,function(t,e,i){for(var o,a={},n=/(data-)?([\w\d\-]+?)="(.+?)"/g,r=null,l="[glossary_"+e;Boolean(r=n.exec(i))===!0;)"data-"===r[1]&&"type"===r[2]||(y.indexOf(o)>-1&&"undefined"!=typeof r[1]?a[r[1]+r[2]]=r[3]:a[r[2]]=r[3]);for(o in a)a.hasOwnProperty(o)&&(l+=" "+o+'="'+a[o]+'"');return l+"/]"})}]}(Ithoughts.v3);