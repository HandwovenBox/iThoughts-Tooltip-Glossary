<!DOCTYPE html>

<html>
<head>
  <title>wait.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ithoughts_tt_gl-admin.html">
                  ithoughts_tt_gl-admin.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-atoz.html">
                  ithoughts_tt_gl-atoz.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-editor.html">
                  ithoughts_tt_gl-editor.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-floater.html">
                  ithoughts_tt_gl-floater.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-qtip2.html">
                  ithoughts_tt_gl-qtip2.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-styleeditor.html">
                  ithoughts_tt_gl-styleeditor.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-tinymce-forms.html">
                  ithoughts_tt_gl-tinymce-forms.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-tinymce.html">
                  ithoughts_tt_gl-tinymce.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-updater.html">
                  ithoughts_tt_gl-updater.js
                </a>
              
                
                <a class="source" href="bootstrap.html">
                  bootstrap.js
                </a>
              
                
                <a class="source" href="casperjs.html">
                  casperjs.js
                </a>
              
                
                <a class="source" href="style-switcher.html">
                  style-switcher.js
                </a>
              
                
                <a class="source" href="casper.html">
                  casper.js
                </a>
              
                
                <a class="source" href="cli.html">
                  cli.js
                </a>
              
                
                <a class="source" href="clientutils.html">
                  clientutils.js
                </a>
              
                
                <a class="source" href="colorizer.html">
                  colorizer.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="http.html">
                  http.js
                </a>
              
                
                <a class="source" href="mouse.html">
                  mouse.js
                </a>
              
                
                <a class="source" href="pagestack.html">
                  pagestack.js
                </a>
              
                
                <a class="source" href="querystring.html">
                  querystring.js
                </a>
              
                
                <a class="source" href="tester.html">
                  tester.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="xunit.html">
                  xunit.js
                </a>
              
                
                <a class="source" href="bbcshots.html">
                  bbcshots.js
                </a>
              
                
                <a class="source" href="cliplay.html">
                  cliplay.js
                </a>
              
                
                <a class="source" href="customevents.html">
                  customevents.js
                </a>
              
                
                <a class="source" href="customlogging.html">
                  customlogging.js
                </a>
              
                
                <a class="source" href="download.html">
                  download.js
                </a>
              
                
                <a class="source" href="dynamic.html">
                  dynamic.js
                </a>
              
                
                <a class="source" href="each.html">
                  each.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="extends.html">
                  extends.js
                </a>
              
                
                <a class="source" href="googlelinks.html">
                  googlelinks.js
                </a>
              
                
                <a class="source" href="googlematch.html">
                  googlematch.js
                </a>
              
                
                <a class="source" href="googlepagination.html">
                  googlepagination.js
                </a>
              
                
                <a class="source" href="googletesting.html">
                  googletesting.js
                </a>
              
                
                <a class="source" href="logcolor.html">
                  logcolor.js
                </a>
              
                
                <a class="source" href="metaextract.html">
                  metaextract.js
                </a>
              
                
                <a class="source" href="multirun.html">
                  multirun.js
                </a>
              
                
                <a class="source" href="screenshot.html">
                  screenshot.js
                </a>
              
                
                <a class="source" href="statushandlers.html">
                  statushandlers.js
                </a>
              
                
                <a class="source" href="steptimeout.html">
                  steptimeout.js
                </a>
              
                
                <a class="source" href="timeout.html">
                  timeout.js
                </a>
              
                
                <a class="source" href="translate.html">
                  translate.js
                </a>
              
                
                <a class="source" href="syntax.html">
                  syntax.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
                
                <a class="source" href="hook.html">
                  hook.js
                </a>
              
                
                <a class="source" href="test1.html">
                  test1.js
                </a>
              
                
                <a class="source" href="test2.html">
                  test2.js
                </a>
              
                
                <a class="source" href="test3.html">
                  test3.js
                </a>
              
                
                <a class="source" href="mod.html">
                  mod.js
                </a>
              
                
                <a class="source" href="bar.html">
                  bar.js
                </a>
              
                
                <a class="source" href="baz.html">
                  baz.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
                
                <a class="source" href="mod.html">
                  mod.js
                </a>
              
                
                <a class="source" href="test.html">
                  test.js
                </a>
              
                
                <a class="source" href="test_coffee.html">
                  test_coffee.js
                </a>
              
                
                <a class="source" href="test_node_json.html">
                  test_node_json.js
                </a>
              
                
                <a class="source" href="test_node_mod.html">
                  test_node_mod.js
                </a>
              
                
                <a class="source" href="test_node_mod_index.html">
                  test_node_mod_index.js
                </a>
              
                
                <a class="source" href="test_node_mod_json_package.html">
                  test_node_mod_json_package.js
                </a>
              
                
                <a class="source" href="test_node_mod.html">
                  test_node_mod.js
                </a>
              
                
                <a class="source" href="test_patched_require.html">
                  test_patched_require.js
                </a>
              
                
                <a class="source" href="options.html">
                  options.js
                </a>
              
                
                <a class="source" href="script.html">
                  script.js
                </a>
              
                
                <a class="source" href="casper-instance-override.html">
                  casper-instance-override.js
                </a>
              
                
                <a class="source" href="dubious.html">
                  dubious.js
                </a>
              
                
                <a class="source" href="exit.html">
                  exit.js
                </a>
              
                
                <a class="source" href="failing.html">
                  failing.js
                </a>
              
                
                <a class="source" href="mytest.html">
                  mytest.js
                </a>
              
                
                <a class="source" href="passing.html">
                  passing.js
                </a>
              
                
                <a class="source" href="skipped.html">
                  skipped.js
                </a>
              
                
                <a class="source" href="step_throws.html">
                  step_throws.js
                </a>
              
                
                <a class="source" href="waitFor_timeout.html">
                  waitFor_timeout.js
                </a>
              
                
                <a class="source" href="run.html">
                  run.js
                </a>
              
                
                <a class="source" href="jsmodule.html">
                  jsmodule.js
                </a>
              
                
                <a class="source" href="selftest.html">
                  selftest.js
                </a>
              
                
                <a class="source" href="dummy.html">
                  dummy.js
                </a>
              
                
                <a class="source" href="include1.html">
                  include1.js
                </a>
              
                
                <a class="source" href="include2.html">
                  include2.js
                </a>
              
                
                <a class="source" href="agent.html">
                  agent.js
                </a>
              
                
                <a class="source" href="alert.html">
                  alert.js
                </a>
              
                
                <a class="source" href="auth.html">
                  auth.js
                </a>
              
                
                <a class="source" href="bypass.html">
                  bypass.js
                </a>
              
                
                <a class="source" href="callback.html">
                  callback.js
                </a>
              
                
                <a class="source" href="callutils.html">
                  callutils.js
                </a>
              
                
                <a class="source" href="capture.html">
                  capture.js
                </a>
              
                
                <a class="source" href="click.html">
                  click.js
                </a>
              
                
                <a class="source" href="confirm.html">
                  confirm.js
                </a>
              
                
                <a class="source" href="content.html">
                  content.js
                </a>
              
                
                <a class="source" href="css3selector.html">
                  css3selector.js
                </a>
              
                
                <a class="source" href="debug.html">
                  debug.js
                </a>
              
                
                <a class="source" href="elementattribute.html">
                  elementattribute.js
                </a>
              
                
                <a class="source" href="encode.html">
                  encode.js
                </a>
              
                
                <a class="source" href="encodedurl.html">
                  encodedurl.js
                </a>
              
                
                <a class="source" href="evaluate.html">
                  evaluate.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="exists.html">
                  exists.js
                </a>
              
                
                <a class="source" href="fetchtext.html">
                  fetchtext.js
                </a>
              
                
                <a class="source" href="formfill.html">
                  formfill.js
                </a>
              
                
                <a class="source" href="frames.html">
                  frames.js
                </a>
              
                
                <a class="source" href="getplaintext.html">
                  getplaintext.js
                </a>
              
                
                <a class="source" href="global.html">
                  global.js
                </a>
              
                
                <a class="source" href="headers.html">
                  headers.js
                </a>
              
                
                <a class="source" href="history.html">
                  history.js
                </a>
              
                
                <a class="source" href="hooks.html">
                  hooks.js
                </a>
              
                
                <a class="source" href="keys.html">
                  keys.js
                </a>
              
                
                <a class="source" href="location.html">
                  location.js
                </a>
              
                
                <a class="source" href="logging.html">
                  logging.js
                </a>
              
                
                <a class="source" href="mouseevents.html">
                  mouseevents.js
                </a>
              
                
                <a class="source" href="multiplepopups.html">
                  multiplepopups.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="newpage.html">
                  newpage.js
                </a>
              
                
                <a class="source" href="onerror.html">
                  onerror.js
                </a>
              
                
                <a class="source" href="open.html">
                  open.js
                </a>
              
                
                <a class="source" href="pagerequest.html">
                  pagerequest.js
                </a>
              
                
                <a class="source" href="popup.html">
                  popup.js
                </a>
              
                
                <a class="source" href="prompt.html">
                  prompt.js
                </a>
              
                
                <a class="source" href="reload.html">
                  reload.js
                </a>
              
                
                <a class="source" href="request.html">
                  request.js
                </a>
              
                
                <a class="source" href="resources.html">
                  resources.js
                </a>
              
                
                <a class="source" href="scripts.html">
                  scripts.js
                </a>
              
                
                <a class="source" href="scroll.html">
                  scroll.js
                </a>
              
                
                <a class="source" href="sendAjax.html">
                  sendAjax.js
                </a>
              
                
                <a class="source" href="start.html">
                  start.js
                </a>
              
                
                <a class="source" href="steps.html">
                  steps.js
                </a>
              
                
                <a class="source" href="urls.html">
                  urls.js
                </a>
              
                
                <a class="source" href="viewport.html">
                  viewport.js
                </a>
              
                
                <a class="source" href="visible.html">
                  visible.js
                </a>
              
                
                <a class="source" href="wait.html">
                  wait.js
                </a>
              
                
                <a class="source" href="xpath.html">
                  xpath.js
                </a>
              
                
                <a class="source" href="cli.html">
                  cli.js
                </a>
              
                
                <a class="source" href="clientutils.html">
                  clientutils.js
                </a>
              
                
                <a class="source" href="fs.html">
                  fs.js
                </a>
              
                
                <a class="source" href="http_status.html">
                  http_status.js
                </a>
              
                
                <a class="source" href="pagestack.html">
                  pagestack.js
                </a>
              
                
                <a class="source" href="require.html">
                  require.js
                </a>
              
                
                <a class="source" href="assert.html">
                  assert.js
                </a>
              
                
                <a class="source" href="begin-config.html">
                  begin-config.js
                </a>
              
                
                <a class="source" href="setup-teardown-async.html">
                  setup-teardown-async.js
                </a>
              
                
                <a class="source" href="setup-teardown.html">
                  setup-teardown.js
                </a>
              
                
                <a class="source" href="skip.html">
                  skip.js
                </a>
              
                
                <a class="source" href="test-order.html">
                  test-order.js
                </a>
              
                
                <a class="source" href="testcase.html">
                  testcase.js
                </a>
              
                
                <a class="source" href="testsuite.html">
                  testsuite.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="xunit.html">
                  xunit.js
                </a>
              
                
                <a class="source" href="abc.html">
                  abc.js
                </a>
              
                
                <a class="source" href="def.html">
                  def.js
                </a>
              
                
                <a class="source" href="abc.html">
                  abc.js
                </a>
              
                
                <a class="source" href="03_a.html">
                  03_a.js
                </a>
              
                
                <a class="source" href="03_b.html">
                  03_b.js
                </a>
              
                
                <a class="source" href="01_init.html">
                  01_init.js
                </a>
              
                
                <a class="source" href="02_do.html">
                  02_do.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>wait.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*eslint strict:0*/</span>
casper.test.begin(<span class="hljs-string">'wait() tests'</span>, <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    <span class="hljs-keyword">var</span> waitStart;

    casper.start(<span class="hljs-string">'tests/site/index.html'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        waitStart = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
    });

    casper.wait(<span class="hljs-number">250</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.assert(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - waitStart &gt; <span class="hljs-number">250</span>,
            <span class="hljs-string">'Casper.wait() can wait for a given amount of time'</span>);
    });

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitFor() tests'</span>, <span class="hljs-number">4</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    casper.start(<span class="hljs-string">'tests/site/waitFor.html'</span>);

    casper.waitFor(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.evaluate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'li'</span>).length === <span class="hljs-number">4</span>;
        });
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitFor() can wait for something to happen'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitFor() can wait for something to happen'</span>);
    });

    casper.reload().waitFor(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'waitFor() processes onTimeout callback'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'waitFor() processes onTimeout callback'</span>);
    }, <span class="hljs-number">1000</span>);
    
    casper.reload().waitFor(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'waitFor() can run test function when timeout is set to 1'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'waitFor() can not run test function when timeout is set to 1'</span>);
    }, <span class="hljs-number">1</span>);
    
    <span class="hljs-keyword">var</span> testArray = [<span class="hljs-literal">false</span>,<span class="hljs-literal">true</span>];
    <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
    casper.reload().waitFor(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">return</span> testArray[i++];
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'waitFor() can run a last test function after timeout'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'waitFor() can not run a last test function after timeout'</span>);
    }, (<span class="hljs-number">1.5</span>*casper.options.retryTimeout));
    
    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitForResource() tests'</span>, <span class="hljs-number">2</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    casper.start(<span class="hljs-string">'tests/site/waitFor.html'</span>);

    casper.waitForResource(<span class="hljs-string">'phantom.png'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForResource() waits for a resource'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitForResource() waits for a resource'</span>);
    });

    casper.reload().waitForResource(<span class="hljs-regexp">/phantom\.png$/</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForResource() waits for a resource using RegExp'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitForResource() waits for a resource using RegExp'</span>);
    });

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitForSelector() tests'</span>, <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    casper.start(<span class="hljs-string">'tests/site/waitFor.html'</span>);

    casper.waitForSelector(<span class="hljs-string">'li:nth-child(4)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForSelector() waits for a selector to exist'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitForSelector() waits for a selector to exist'</span>);
    });

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitForText() tests'</span>, <span class="hljs-number">3</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    casper.start(<span class="hljs-string">'tests/site/waitFor.html'</span>);

    casper.waitForText(<span class="hljs-string">'&lt;li&gt;four&lt;/li&gt;'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForText() can wait for text'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitForText() can wait for text'</span>);
    });

    casper.reload().waitForText(<span class="hljs-regexp">/four/i</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForText() can wait for regexp'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitForText() can wait for regexp'</span>);
    });

    casper.reload().waitForText(<span class="hljs-string">'Voilà'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForText() can wait for decoded HTML text'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitForText() can wait for decoded HTML text'</span>);
    }, <span class="hljs-number">1000</span>);

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitForSelectorTextChange() tests'</span>, <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    casper.start(<span class="hljs-string">'tests/site/waitFor.html'</span>);

    casper.waitForSelectorTextChange(<span class="hljs-string">'#textChange'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForSelectorTextChange() can wait for text on a selector to change'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitForSelectorTextChange() can wait for text on a selector to change'</span>);
    });

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitUntilVisible() tests'</span>, <span class="hljs-number">2</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    casper.start(<span class="hljs-string">'tests/site/waitFor.html'</span>);

    casper.waitUntilVisible(<span class="hljs-string">'li:nth-child(4)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitUntilVisible() waits for a selector being visible'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitUntilVisible() waits for a selector being visible'</span>);
    });

    casper.waitUntilVisible(<span class="hljs-string">'p'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitUntilVisible() waits for a selector being visible'</span>);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.fail(<span class="hljs-string">'Casper.waitUntilVisible() waits for a selector being visible'</span>);
    });

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitForUrl() regexp tests'</span>, <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    casper.start().thenEvaluate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-built_in">document</span>.location = <span class="hljs-string">'./form.html'</span>;
        }, <span class="hljs-number">100</span>);
    });

    casper.waitForUrl(<span class="hljs-regexp">/form\.html$/</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForUrl() waits for a given regexp url'</span>);
    });

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitForUrl() string tests'</span>, <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    casper.start().thenEvaluate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-built_in">document</span>.location = <span class="hljs-string">'./form.html'</span>;
        }, <span class="hljs-number">100</span>);
    });

    casper.waitForUrl(<span class="hljs-string">'form.html'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.pass(<span class="hljs-string">'Casper.waitForUrl() waits for a given string url'</span>);
    });

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});

casper.test.begin(<span class="hljs-string">'waitForExec() tests'</span>, <span class="hljs-number">24</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    <span class="hljs-keyword">if</span> (phantom.casperEngine === <span class="hljs-string">'slimerjs'</span>) {
        test.skip(<span class="hljs-number">24</span>, <span class="hljs-string">'SlimerJS DOES NOT HAVE A child_process MODULE'</span>);  
    } <span class="hljs-keyword">else</span> {    
        <span class="hljs-keyword">var</span> system = <span class="hljs-built_in">require</span>(<span class="hljs-string">'system'</span>);
        <span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
        <span class="hljs-keyword">var</span> lsExecutable;
        <span class="hljs-keyword">var</span> shExecutable;
        <span class="hljs-keyword">if</span> (system.os.name != <span class="hljs-string">"windows"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Seems to be crashing here in slimerJs 0.10.x, added fs.exists before fs.isExecutable for testing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            lsExecutable = system.env.PATH.split(<span class="hljs-string">':'</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) </span>{
                <span class="hljs-keyword">var</span> fileString = path + fs.separator + <span class="hljs-string">'ls'</span>;
                <span class="hljs-keyword">return</span> (fs.exists(fileString) &amp;&amp; fs.isExecutable(fileString));
            })[<span class="hljs-number">0</span>] + fs.separator + <span class="hljs-string">'ls'</span>;
            shExecutable = system.env.PATH.split(<span class="hljs-string">':'</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path</span>) </span>{
                <span class="hljs-keyword">var</span> fileString = path + fs.separator + <span class="hljs-string">'sh'</span>;
                <span class="hljs-keyword">return</span> (fs.exists(fileString) &amp;&amp; fs.isExecutable(fileString));
            })[<span class="hljs-number">0</span>] + fs.separator + <span class="hljs-string">'sh'</span>;
        };
        <span class="hljs-keyword">var</span> notExecutable = <span class="hljs-string">''</span>;
        <span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (!notExecutable) {
            notExecutable = (!fs.exists(fs.workingDirectory + fs.separator + <span class="hljs-string">'run'</span> + k + <span class="hljs-string">'.exe'</span>)) ? fs.workingDirectory + fs.separator + <span class="hljs-string">'run'</span> + k + <span class="hljs-string">'.exe'</span> : <span class="hljs-string">''</span>;
            k++;
        };
        
        casper.start(<span class="hljs-string">''</span>);

        casper.waitForExec(<span class="hljs-literal">null</span>, [],</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Add success1 because on some systems the default system shell maybe exits by itself after being called(?)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-literal">null</span>,
            <span class="hljs-comment">/*
            function success1(details) {
                test.assert((utils.isObject(details.data.command) &amp;&amp; utils.isString(details.data.command.program) &amp;&amp; utils.isArray(details.data.command.parameters)), 'Casper.waitForExec() can call the default system shell and it exits before timeout: "' + JSON.stringify(details.data.command) + '"');
                test.assertEquals(details.data.isChildNotFinished, 0,'Default system shell returned "isChildNotFinished" 0 before timeout');
                test.assert(utils.isNumber(details.data.exitCode), 'Default system shell "' + JSON.stringify(details.data.command) + '" exited before timeout with exit code ' + details.data.exitCode);
                
            },
            */</span>
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeout1</span>(<span class="hljs-params">timeout, details</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>exit code value seems to be 0 when phantom kills the process before 2.1.1(?)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> valueOfExitCode = (utils.matchEngine({<span class="hljs-attr">name</span>: <span class="hljs-string">'phantomjs'</span>, <span class="hljs-attr">version</span>: {<span class="hljs-attr">min</span>: <span class="hljs-string">'1.9.0'</span>, <span class="hljs-attr">max</span>: <span class="hljs-string">'2.1.0'</span>}})) ? <span class="hljs-number">0</span> : <span class="hljs-number">15</span>;
                test.assert((utils.isString(details.data.command) &amp;&amp; utils.isArray(details.data.parameters)), <span class="hljs-string">'Casper.waitForExec() can call the default system shell and kills it on timeout: '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data));
                test.assert( (utils.isNumber(details.data.pid) &amp;&amp; ( details.data.pid &gt; <span class="hljs-number">0</span>) ), <span class="hljs-string">'Default system shell exited on timeout (TERM signal) and used PID '</span> + details.data.pid);
                test.assertEquals(details.data.isChildNotFinished, <span class="hljs-number">0</span>,<span class="hljs-string">'Default system shell returned "isChildNotFinished" 0 on timeout'</span>);
                test.assertEquals(details.data.exitCode, valueOfExitCode, <span class="hljs-string">'Default system shell exited on timeout (TERM signal) with exit code '</span> + details.data.exitCode);
              
        }, <span class="hljs-number">2000</span>);

        casper.reload().waitForExec(notExecutable, [],
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success2</span>(<span class="hljs-params">details</span>) </span>{
                test.assert((utils.isString(details.data.command) &amp;&amp; utils.isArray(details.data.parameters)), <span class="hljs-string">'Casper.waitForExec() tried to call non existing executable: '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data));
                test.assertEquals(details.data.pid, <span class="hljs-number">0</span>,<span class="hljs-string">'Non existing executable returned "pid" 0'</span>);
                test.assertEquals(details.data.isChildNotFinished, <span class="hljs-number">0</span>,<span class="hljs-string">'Non existing executable returned "isChildNotFinished" 0'</span>);
                test.assertEquals(details.data.exitCode, <span class="hljs-literal">null</span>, <span class="hljs-string">'Non existing executable returned exitCode null'</span>);
                test.assertEquals(details.data.elapsedTime, <span class="hljs-literal">null</span>, <span class="hljs-string">'Non existing executable returned elapsedTime null'</span>);
        });

        <span class="hljs-keyword">if</span> (system.os.name != <span class="hljs-string">"windows"</span>) {
            <span class="hljs-keyword">if</span> (lsExecutable) {

                casper.reload().waitForExec(lsExecutable, [<span class="hljs-string">'-a'</span>,fs.workingDirectory],
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success3</span>(<span class="hljs-params">details</span>) </span>{
                        test.assert((utils.isString(details.data.command) &amp;&amp; utils.isArray(details.data.parameters)), <span class="hljs-string">'Casper.waitForExec() can call "lsExecutable" on "workingDirectory": '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data));
                        test.assert( (utils.isNumber(details.data.pid) &amp;&amp; ( details.data.pid &gt; <span class="hljs-number">0</span>) ), <span class="hljs-string">'"lsExecutable" on "workingDirectory" used PID '</span> + details.data.pid);
                        test.assertEquals(details.data.isChildNotFinished, <span class="hljs-number">0</span>,<span class="hljs-string">'"lsExecutable" on "workingDirectory" returned "isChildNotFinished" 0'</span>);
                        test.assertEquals(details.data.exitCode, <span class="hljs-number">0</span>, <span class="hljs-string">'"lsExecutable" on "workingDirectory" returned exitCode 0'</span>);
                        test.assertTruthy(details.data.stdout, <span class="hljs-string">'"lsExecutable" on "workingDirectory" returned stdout '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data.stdout));
                });

                casper.reload().waitForExec(lsExecutable, [notExecutable],
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success4</span>(<span class="hljs-params">details</span>) </span>{
                        test.assert((utils.isString(details.data.command) &amp;&amp; utils.isArray(details.data.parameters)), <span class="hljs-string">'Casper.waitForExec() can call "lsExecutable" on "notExecutable": '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data));
                        test.assert( (utils.isNumber(details.data.pid) &amp;&amp; ( details.data.pid &gt; <span class="hljs-number">0</span>) ), <span class="hljs-string">'"lsExecutable" on "notExecutable" used PID '</span> + details.data.pid);
                        test.assertEquals(details.data.isChildNotFinished, <span class="hljs-number">0</span>,<span class="hljs-string">'"lsExecutable" on "notExecutable" returned "isChildNotFinished" 0'</span>);
                        test.assertTruthy(details.data.exitCode, <span class="hljs-string">'"lsExecutable" on "notExecutable" returned exitCode '</span> + details.data.exitCode);
                        test.assertTruthy(details.data.stderr, <span class="hljs-string">'"lsExecutable" on "notExecutable" returned stderr '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data.stderr));
                });

            } <span class="hljs-keyword">else</span> {
                casper.reload().then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    test.skip(<span class="hljs-number">10</span>, <span class="hljs-string">'ls EXECUTABLE NOT FOUND'</span>);  
                });
            };

            <span class="hljs-keyword">if</span> (shExecutable) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>vars used to measure if ‘shell script to trap TERM signal’ is waiting enough and being killed faster enough</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> shellTrapTimeout = <span class="hljs-number">500</span>;
                <span class="hljs-keyword">var</span> shellTrapTermTimeout = <span class="hljs-number">1000</span>;
                <span class="hljs-keyword">var</span> timeLapseAfterKillSignal = <span class="hljs-number">300</span>;
                <span class="hljs-keyword">var</span> minTimeLapse = shellTrapTimeout + shellTrapTermTimeout;
                <span class="hljs-keyword">var</span> maxTimeLapse = minTimeLapse + timeLapseAfterKillSignal;
                casper.then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-comment">// inside then for elapsedTime don't be added with other tests elapsedTime</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>on my tests ‘TERM trapped!’ will not be on stdout because ‘shExecutable’ is killed with SIGKILL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    casper.reload().waitForExec(shExecutable + <span class="hljs-string">' -c'</span>, [<span class="hljs-string">'trap "echo TERM trapped!" TERM ; sleep 60'</span>], <span class="hljs-literal">null</span>,
                        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeout5</span>(<span class="hljs-params">timeout,details</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>exit code value seems to be 0 when phantom kills the process before 2.1.1(?)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">var</span> valueOfExitCode = (utils.matchEngine({<span class="hljs-attr">name</span>: <span class="hljs-string">'phantomjs'</span>, <span class="hljs-attr">version</span>: {<span class="hljs-attr">min</span>: <span class="hljs-string">'1.9.0'</span>, <span class="hljs-attr">max</span>: <span class="hljs-string">'2.1.0'</span>}})) ? <span class="hljs-number">0</span> : <span class="hljs-number">9</span>;
                            test.assert((utils.isString(details.data.command) &amp;&amp; utils.isArray(details.data.parameters)), <span class="hljs-string">'Casper.waitForExec() can call shell script to trap TERM signal and then kills it: '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data));
                            test.assert( (utils.isNumber(details.data.pid) &amp;&amp; ( details.data.pid &gt; <span class="hljs-number">0</span>) ), <span class="hljs-string">'shell script to trap TERM signal used PID '</span> + details.data.pid);
                            test.assertEquals(details.data.isChildNotFinished, <span class="hljs-number">0</span>, <span class="hljs-string">'shell script to trap TERM signal returned "isChildNotFinished" 0'</span>);
                            test.assertEquals(details.data.exitCode, valueOfExitCode, <span class="hljs-string">'shell script to trap TERM signal returned exitCode '</span> + details.data.exitCode);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>test if it first waited for shellTrapTimeout ms, then waited for shellTrapTermTimeout ms after TERM signal, then exited faster (timeLapseAfterKillSignal ms or less) with KILL signal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            test.assert( (utils.isNumber(details.data.elapsedTime) &amp;&amp; (details.data.elapsedTime &lt;= maxTimeLapse) &amp;&amp; (details.data.elapsedTime &gt; minTimeLapse) ), <span class="hljs-string">'shell script to trap TERM signal run and killed in more than '</span> + minTimeLapse + <span class="hljs-string">'ms and in less than or equal to '</span> + maxTimeLapse + <span class="hljs-string">'ms: '</span> + details.data.elapsedTime);
                    }, [shellTrapTimeout, shellTrapTermTimeout]);
                });
                
            } <span class="hljs-keyword">else</span> {
                casper.reload().then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    test.skip(<span class="hljs-number">5</span>, <span class="hljs-string">'sh EXECUTABLE NOT FOUND'</span>);  
                });
            };
            
        } <span class="hljs-keyword">else</span> {
            
            casper.reload().waitForExec(<span class="hljs-literal">null</span>, [<span class="hljs-string">'/c'</span>, <span class="hljs-string">'dir'</span>, fs.workingDirectory],
                <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">details</span>) </span>{
                        test.assert((utils.isString(details.data.command) &amp;&amp; utils.isArray(details.data.parameters)), <span class="hljs-string">'Casper.waitForExec() can call dir on "workingDirectory": '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data));
                        test.assert( (utils.isNumber(details.data.pid) &amp;&amp; ( details.data.pid &gt; <span class="hljs-number">0</span>) ), <span class="hljs-string">'dir on "workingDirectory" used PID '</span> + details.data.pid);
                        test.assertEquals(details.data.isChildNotFinished, <span class="hljs-number">0</span>,<span class="hljs-string">'dir on "workingDirectory" returned "isChildNotFinished" 0'</span>);
                        test.assertEquals(details.data.exitCode, <span class="hljs-number">0</span>, <span class="hljs-string">'dir on "workingDirectory" returned exitCode 0'</span>);
                        test.assertTruthy(details.data.stdout, <span class="hljs-string">'dir on "workingDirectory" returned stdout '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data.stdout));
            });

            casper.reload().waitForExec(<span class="hljs-literal">null</span>, [<span class="hljs-string">'/c'</span>, <span class="hljs-string">'dir'</span>, notExecutable],
                <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">details</span>) </span>{
                    test.assert((utils.isString(details.data.command) &amp;&amp; utils.isArray(details.data.parameters)), <span class="hljs-string">'Casper.waitForExec() can dir on "notExecutable": '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data));
                    test.assert( (utils.isNumber(details.data.pid) &amp;&amp; ( details.data.pid &gt; <span class="hljs-number">0</span>) ), <span class="hljs-string">'dir on "notExecutable" used PID '</span> + details.data.pid);
                    test.assertEquals(details.data.isChildNotFinished, <span class="hljs-number">0</span>, <span class="hljs-string">'dir on "notExecutable" returned "isChildNotFinished" 0'</span>);
                    test.assertTruthy(details.data.exitCode, <span class="hljs-string">'dir on "notExecutable" returned exitCode '</span> + details.data.exitCode);
                    test.assertTruthy(details.data.stderr, <span class="hljs-string">'dir on "notExecutable" returned stderr '</span> + <span class="hljs-built_in">JSON</span>.stringify(details.data.stderr));
            });
            
            casper.reload().then( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                test.skip(<span class="hljs-number">5</span>, <span class="hljs-string">'WINDOWS SYSTEM, CAN NOT EASILY TRAP TERM SIGNAL ON SHELL SCRIPT'</span>);  
            });
            
        };

    };

    casper.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        test.done();
    });
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
