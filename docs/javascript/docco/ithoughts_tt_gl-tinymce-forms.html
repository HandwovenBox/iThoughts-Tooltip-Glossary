<!DOCTYPE html>

<html>
<head>
  <title>ithoughts_tt_gl-tinymce-forms.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ithoughts_tt_gl-admin.html">
                  ithoughts_tt_gl-admin.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-atoz.html">
                  ithoughts_tt_gl-atoz.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-editor.html">
                  ithoughts_tt_gl-editor.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-floater.html">
                  ithoughts_tt_gl-floater.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-qtip2.html">
                  ithoughts_tt_gl-qtip2.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-styleeditor.html">
                  ithoughts_tt_gl-styleeditor.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-tinymce-forms.html">
                  ithoughts_tt_gl-tinymce-forms.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-tinymce.html">
                  ithoughts_tt_gl-tinymce.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-updater.html">
                  ithoughts_tt_gl-updater.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-admin.html">
                  ithoughts_tt_gl-admin.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-atoz.html">
                  ithoughts_tt_gl-atoz.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-editor.html">
                  ithoughts_tt_gl-editor.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-floater.html">
                  ithoughts_tt_gl-floater.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-qtip2.html">
                  ithoughts_tt_gl-qtip2.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-styleeditor.html">
                  ithoughts_tt_gl-styleeditor.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-tinymce-forms.html">
                  ithoughts_tt_gl-tinymce-forms.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-tinymce.html">
                  ithoughts_tt_gl-tinymce.js
                </a>
              
                
                <a class="source" href="ithoughts_tt_gl-updater.html">
                  ithoughts_tt_gl-updater.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>ithoughts_tt_gl-tinymce-forms.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * @file Client-side scripts for handling tooltip creation wizzard in Wordpress TinyMCE
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license https://www.gnu.org/licenses/gpl-3.0.html GPLv3
 * @package ithoughts-tooltip-glossary
 *
 * @version 2.7.0
 */</span>
<span class="hljs-meta">
'use strict'</span>;

<span class="hljs-comment">/*global tinymce:false, iThoughtsTooltipGlossaryEditor: false */</span>

( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selfCalling</span>(<span class="hljs-params"> ithoughts </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>As usual, assign our most comon globals usage to local ones for minification</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> $		= ithoughts.$,
		$d		= ithoughts.$d,
		$w		= ithoughts.$w,
		itge	= iThoughtsTooltipGlossaryEditor;
	$d.ready( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onDocumentReady</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> formType = <span class="hljs-string">''</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Depending on the ID present, we can deduce if we are in TIP or LIST creation/edition mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> ( <span class="hljs-number">1</span> === $( <span class="hljs-string">'#ithoughts_tt_gl-tooltip-form-container'</span> ).length ) {
			formType = <span class="hljs-string">'TIP'</span>;
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-number">1</span> === $( <span class="hljs-string">'#ithoughts_tt_gl-list-form-container'</span> ).length ) {
			formType = <span class="hljs-string">'LIST'</span>;
		} <span class="hljs-keyword">else</span> {
			itge.error( <span class="hljs-string">'Does not contains a tooltip form nor a list form, exit'</span> );
			<span class="hljs-keyword">return</span>;
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h5 id="-inittab-set-up-a-tab-switcher-element"><code>initTab</code>: Set up a tab switcher element</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-comment">/**
		 * @function initTab
		 * @description Set up a tab switcher element
		 * @author Gerkin
		 * @param {jQuery} jqobj jQuery selector containing the tabs triggers
		 * @param {Function} [cb] Function to execute with cb( newIndex )
		 * @returns {undefined}
		 */</span>
		<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initTab</span>(<span class="hljs-params"> jqobj, cb </span>) </span>{
			jqobj.click( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onClickTab</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>First, clean the <code>active</code> class on all siblings, then set it only on event emitter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$( <span class="hljs-keyword">this</span> ).parent().find( <span class="hljs-string">'.active'</span> ).removeClass( <span class="hljs-string">'active'</span> );
				$( <span class="hljs-keyword">this</span> ).addClass( <span class="hljs-string">'active'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Then, we check the index of the clicked element (<code>this</code>) in the parent, and we set active the tab with the same index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> index = $( <span class="hljs-keyword">this</span> ).index();
				$( <span class="hljs-keyword">this</span> ).parent().parent().find( <span class="hljs-string">' &gt; .active'</span> ).removeClass( <span class="hljs-string">'active'</span> );
				$( $( <span class="hljs-keyword">this</span> ).parent().parent().children()[index + <span class="hljs-number">1</span>]).addClass( <span class="hljs-string">'active'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Then we try to call the callback (if set)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				cb &amp;&amp; cb( index );
			});</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Self-set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			jqobj.filter( <span class="hljs-string">'.active'</span> ).click();
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="tip-form">Tip form</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> ( <span class="hljs-string">'TIP'</span> === formType ) {
			( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initTipForm</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Define the container for tooltip options in parent scope, so it can be used accross several events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> tooltipOpts;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Initialize the tab switcher between mode Glossary, Tooltip &amp; Mediatip</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				initTab( $( <span class="hljs-string">'#ithoughts_tt_gl-tooltip-form .tabs li'</span> ), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params"> index </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Only Glossary tooltip (tab @ index 0) disable the custom link editor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$( <span class="hljs-string">'#ithoughts_tt_gl_link'</span> ).prop( <span class="hljs-string">'disabled'</span>, <span class="hljs-number">0</span> === index );
				});</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Initialize the tab switcher of advanced options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				initTab( $( <span class="hljs-string">'#ithoughts_tt_gl-tooltip-form-options .tabs li'</span> ));</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Mode switcher for mediatips.  Hide all except the selected mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$( <span class="hljs-string">'.modeswitcher'</span> ).on( <span class="hljs-string">'click keyup'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">switchMode</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> id = <span class="hljs-keyword">this</span>.id;
					$( <span class="hljs-string">`[data-<span class="hljs-subst">${  id  }</span>]:not([data-<span class="hljs-subst">${  id  }</span>="mediatip-<span class="hljs-subst">${  <span class="hljs-keyword">this</span>.value  }</span>-type"])`</span> ).hide();
					$( <span class="hljs-string">`[data-<span class="hljs-subst">${  id  }</span>~="mediatip-<span class="hljs-subst">${  <span class="hljs-keyword">this</span>.value  }</span>-type"]`</span> ).show();
				}).keyup();</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h5 id="-removeeditor-clean-an-editor"><code>removeEditor</code>: Clean an editor</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-comment">/**
				 * @function removeEditor
				 * @description Clean an editor
				 * @author gerkin
				 * @param   {String} editorId Id of the editor to delete
				 * @returns {undefined}
				 */</span>
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeEditor</span>(<span class="hljs-params"> editorId </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Sometimes (depending on the browser AFAIK), TinyMCE fails to execute the command to remove an editor. We then have to clean its data manually</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">try</span> {
						tinymce.EditorManager.execCommand( <span class="hljs-string">'mceRemoveEditor'</span>, <span class="hljs-literal">true</span>, editorId );
					} <span class="hljs-keyword">catch</span> ( e ) {
						iThoughtsTooltipGlossary.warn( <span class="hljs-string">'Force cleaning needed: '</span>, e );
						tinymce.EditorManager.editors = tinymce.EditorManager.editors.filter( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findEditor</span>(<span class="hljs-params"> editor </span>) </span>{
							<span class="hljs-keyword">return</span> editor.id !== editorId;
						});
					}
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h5 id="-closeform-clean-the-form-then-call-the-callback-function"><code>closeForm</code>: Clean the form, then call the callback function</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-comment">/**
				 * @function closeForm
				 * @description Clean the form, then call the callback function
				 * @author gerkin
				 * @param {Object} data Data of the tooltip
				 * @returns {undefined}
				 */</span>
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeForm</span>(<span class="hljs-params"> data </span>) </span>{
					setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waitRemoveEditor</span>(<span class="hljs-params"></span>) </span>{
						removeEditor( <span class="hljs-string">'ithoughts_tt_gl-tooltip-content'</span> );
					}, <span class="hljs-number">500</span> );
					itge.finishTipTinymce( data );
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h3 id="tinymce-editor-for-tooltips">TinyMCE editor for Tooltips</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>				( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initSubEditor</span>(<span class="hljs-params"> $editors </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Initialize the TinyMCE editor inside the Tooltip tab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$editors.each( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findNewEditor</span>(<span class="hljs-params"> index, editor </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Find a free id. If our editor does not have an ID, we have to generate one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">while</span> ( <span class="hljs-literal">null</span> == editor.getAttribute( <span class="hljs-string">'id'</span> )) {
							<span class="hljs-keyword">var</span> newId = <span class="hljs-string">`editor<span class="hljs-subst">${  <span class="hljs-built_in">Math</span>.random().toString( <span class="hljs-number">36</span> ).replace( <span class="hljs-regexp">/[^a-z]+/g</span>, <span class="hljs-string">''</span> ).substr( <span class="hljs-number">0</span>, <span class="hljs-number">10</span> ) }</span>`</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>If this editor ID is free, then set it. Else, loop using the parent <code>while</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> === $( newId ).length ) {
								editor.setAttribute( <span class="hljs-string">'id'</span>, newId );
							}
						}
						<span class="hljs-keyword">var</span> editorId = editor.getAttribute( <span class="hljs-string">'id'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Save the current text in the not-yet-TinyMCE editor. It will be used later to restore the content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> text = editor.value;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Do effective call to tinymce &amp; init the editor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						tinymce.init({
							<span class="hljs-attr">selector</span>:         <span class="hljs-string">`#<span class="hljs-subst">${  editorId }</span>`</span>,
							<span class="hljs-attr">menubar</span>:          <span class="hljs-literal">false</span>,
							<span class="hljs-attr">external_plugins</span>: {
								<span class="hljs-attr">code</span>:      <span class="hljs-string">`<span class="hljs-subst">${ itge.base_tinymce  }</span>/code/plugin.min.js`</span>,
								<span class="hljs-attr">wordcount</span>: <span class="hljs-string">`<span class="hljs-subst">${ itge.base_tinymce  }</span>/wordcount/plugin.min.js`</span>,
							},
							<span class="hljs-attr">plugins</span>: <span class="hljs-string">'wplink'</span>,
							<span class="hljs-attr">toolbar</span>: [
								<span class="hljs-string">'styleselect | bold italic underline link | bullist numlist | alignleft aligncenter alignright alignjustify | code'</span>,
							],
							<span class="hljs-attr">min_height</span>: <span class="hljs-number">70</span>,
							<span class="hljs-attr">height</span>:     <span class="hljs-number">70</span>,
							<span class="hljs-attr">resize</span>:     <span class="hljs-literal">false</span>,
						});</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><strong>Restore the content</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> intervalContent = setInterval( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waitSubTinyMCELoaded</span>(<span class="hljs-params"></span>) </span>{
							<span class="hljs-keyword">var</span> subeditor = tinymce.get( editorId );</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Check if the subeditor is fully initialized. If that’s the case, set its content &amp; clear interval</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							<span class="hljs-keyword">if</span> ( subeditor &amp;&amp; subeditor.getDoc() &amp;&amp; subeditor.getBody()) {
								itge.log( <span class="hljs-string">'Initing subeditor with content '</span>, <span class="hljs-built_in">JSON</span>.stringify( text ));
								clearInterval( intervalContent );
								subeditor.setContent( text.replace( <span class="hljs-regexp">/&amp;/g</span>, <span class="hljs-string">'&amp;amp;'</span> ));
							}
						}, <span class="hljs-number">50</span> );
					});
				}( $( <span class="hljs-string">'#ithoughts_tt_gl-tooltip-form-container .tinymce'</span> )));</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h3 id="media-library-for-mediatips">Media library for Mediatips</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$( <span class="hljs-string">'#ithoughts_tt_gl_select_image'</span> ).click( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectImage</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>On click on <code>#ithoughts_tt_gl_select_image</code> (the button in mediatip), use the WP media API to get a media</p>
<blockquote>
<p>This code was copy/pasted. It may be improveable</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> mediaFrame = wp.media({
						<span class="hljs-attr">frame</span>:   <span class="hljs-string">'post'</span>,
						<span class="hljs-attr">state</span>:   <span class="hljs-string">'insert'</span>,
						<span class="hljs-attr">library</span>: {
							<span class="hljs-attr">type</span>: [ <span class="hljs-string">'audio'</span>, <span class="hljs-string">'video'</span>, <span class="hljs-string">'image'</span> ],
						},
						<span class="hljs-attr">multiple</span>: <span class="hljs-literal">false</span>,
					});</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><strong>On validation of media library</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					mediaFrame.on( <span class="hljs-string">'insert'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertImage</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Get the infos of the first selected element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> json = mediaFrame.state().get( <span class="hljs-string">'selection'</span> ).first();</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>If nothing selected, return</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">if</span> ( <span class="hljs-literal">null</span> == json ) {
							<span class="hljs-keyword">return</span>;
						}
						json = json.toJSON();</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Encode datas in the JSON input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						$( <span class="hljs-string">'#image-box-data'</span> ).val( <span class="hljs-built_in">JSON</span>.stringify({
							<span class="hljs-attr">url</span>:  json.url,
							<span class="hljs-attr">id</span>:   json.id,
							<span class="hljs-attr">link</span>: json.link,
						}));</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Display selected image</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						$( <span class="hljs-string">'#image-box'</span> ).html( <span class="hljs-string">`&lt;img src="<span class="hljs-subst">${  json.url  }</span>"/&gt;`</span> );
						$( <span class="hljs-string">'#mediatip_caption'</span> ).val( json.caption );
						$( <span class="hljs-string">'#ithoughts_tt_gl_link'</span> ).val( json.link );
					});</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Open the media library</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					mediaFrame.open();
				});</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h3 id="autocomplete-for-glossaries">Autocomplete for Glossaries</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>				( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initAutoComplete</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> input = $( <span class="hljs-string">'#glossary_term'</span> ),
						completerHolder = $( <span class="hljs-string">'#glossary_term_completer'</span> ),
						completerHolderContainer = $( <span class="hljs-string">'.glossary_term_completer_container'</span> ),
						searchedString = <span class="hljs-string">''</span>,
						request = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h5 id="-losefocustest-check-if-the-completer-holder-or-the-input-has-the-focus"><code>losefocustest</code>: Check if the completer holder or the input has the focus</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">losefocustest</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>The timeout is required to let some time to the browser to change the focus status of the elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waitedForFocus</span>(<span class="hljs-params"></span>) </span>{
							<span class="hljs-keyword">if</span> ( !completerHolder.find( <span class="hljs-string">'*:focus'</span> ).length &amp;&amp; !input.is( <span class="hljs-string">':focus'</span> )) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Hide the <code>completerHolder</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								completerHolderContainer.addClass( <span class="hljs-string">'hidden'</span> );
							}
						}, <span class="hljs-number">100</span> );
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h5 id="-searchmatchingres-does-all-the-completion-work-from-retrieved-term-catalog"><code>searchMatchingRes</code>: Does all the completion work from retrieved term catalog</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">searchMatchingRes</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>First, we filter terms contained in the global hash <code>iThoughtsTooltipGlossaryEditor</code>. Those terms will be splitted in 2 categories:</p>
<ul>
<li>those which <strong>starts</strong> with the searched string</li>
<li>those which <strong>contains</strong> the searched string</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> startsWith = [];
						<span class="hljs-keyword">var</span> contains = [];
						itge.terms.map( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mapTerms</span>(<span class="hljs-params"> element </span>) </span>{
							<span class="hljs-keyword">var</span> indx = element.title.toLowerCase().indexOf( searchedString );
							<span class="hljs-keyword">if</span> ( <span class="hljs-number">-1</span> === indx )							{
								indx = element.slug.toLowerCase().indexOf( searchedString );
							}
							<span class="hljs-keyword">if</span> ( <span class="hljs-number">-1</span> === indx ) {
								<span class="hljs-keyword">return</span>;
							} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> === indx ) {
								startsWith.push( element );
								<span class="hljs-keyword">return</span>;
							} <span class="hljs-keyword">else</span> {
								contains.push( element );
							}
						});</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Then, concat both arrays to have the terms starting with the search before those who just contains the search</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> searchResults = startsWith.concat( contains ).filter( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unique</span>(<span class="hljs-params"> item, pos, self </span>) </span>{
							<span class="hljs-keyword">return</span> self.indexOf( item ) === pos;
						});</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Clean the search result container, then re-fill it with items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						completerHolder.empty();
						<span class="hljs-keyword">var</span> length = searchResults.length;
						<span class="hljs-keyword">if</span> ( length &gt; <span class="hljs-number">0</span> ) {
							<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length; i++ ) {
								<span class="hljs-keyword">var</span> item = searchResults[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>If WPML is installed, <code>item</code> should contain the property <code>thislang</code>. If <code>thislang</code> is set to false, then the term is in another language than the current one, and we display it with a particular class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> item.thislang != <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-literal">false</span> === item.thislang )								{
									completerHolder.append( $.parseHTML( <span class="hljs-string">`&lt;div tabindex="0" class="option foreign-language" data-id="<span class="hljs-subst">${  item.id  }</span>" data-excerpt="<span class="hljs-subst">${  item.content  }</span>"&gt;&lt;p&gt;&lt;b&gt;<span class="hljs-subst">${  item.title  }</span>&lt;/b&gt;&lt;br&gt;&lt;em&gt;<span class="hljs-subst">${  item.slug  }</span>&lt;/em&gt;&lt;/p&gt;&lt;/div&gt;`</span> ));
								}							<span class="hljs-keyword">else</span>								{
									completerHolder.append( $.parseHTML( <span class="hljs-string">`&lt;div tabindex="0" class="option" data-id="<span class="hljs-subst">${  item.id  }</span>" data-excerpt="<span class="hljs-subst">${  item.content  }</span>"&gt;&lt;p&gt;&lt;b&gt;<span class="hljs-subst">${  item.title  }</span>&lt;/b&gt;&lt;br&gt;&lt;em&gt;<span class="hljs-subst">${  item.slug  }</span>&lt;/em&gt;&lt;/p&gt;&lt;/div&gt;`</span> ));
								}
							}
						} <span class="hljs-keyword">else</span> {
							completerHolder.append( $.parseHTML( <span class="hljs-string">'&lt;p style="text-align:center"&gt;&lt;em&gt;No results&lt;/em&gt;&lt;p&gt;'</span> ));
						}</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Once we have filled the search result container, display it and recalculate position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						completerHolderContainer.removeClass( <span class="hljs-string">'hidden'</span> );
						setTimeout( resizeWindow, <span class="hljs-number">25</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>On each result, make them selectable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						completerHolder.find( <span class="hljs-string">'.option'</span> ).on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectCompletion</span>(<span class="hljs-params"> e </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Set inputs with values provided by the option, then hide the completer holder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							$( <span class="hljs-string">'[name="glossary_term_id"]'</span> ).val( e.currentTarget.getAttribute( <span class="hljs-string">'data-id'</span> ));
							input.val( $( e.currentTarget ).find( <span class="hljs-string">'p &gt; b'</span> ).text());
							completerHolderContainer.addClass( <span class="hljs-string">'hidden'</span> );
						});
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h5 id="-resizewindow-set-styles-of-the-completer-holder"><code>resizeWindow</code>: Set styles of the completer holder</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resizeWindow</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>The <code>completerHolder</code> element has to be positionned by JS. In fact, to overflow outside from the modal, it must not be a descendent of the modal. Thus, we can’t position it via CSS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> top = completerHolder.offset().top - $w.scrollTop();
						<span class="hljs-keyword">var</span> bottom = $w.height();
						<span class="hljs-keyword">var</span> height = bottom - top;
						completerHolderContainer.css({
							<span class="hljs-attr">maxHeight</span>: height,
						});
					}
					$w.resize( resizeWindow );</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p><strong>Execute the search action</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					input.on( <span class="hljs-string">'keyup focusin'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focusin</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>First, check if we don’t have any request currently running. If we have one, we have to <code>abort()</code> it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">if</span> ( request )						{
							request.abort();
						}</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Then, compose the search string by removing accents or special characters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						searchedString = itge.removeAccents( $( <span class="hljs-keyword">this</span> ).val().toLowerCase());</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Filter with already retrieved items. This is used to react before the real request is sent, then resulsq will be replaced with new retrieved ones</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						searchMatchingRes();</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Do the request to get elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						request = $.ajax({
							<span class="hljs-attr">url</span>:      itge.admin_ajax,
							<span class="hljs-attr">method</span>:   <span class="hljs-string">'POST'</span>,
							<span class="hljs-attr">dataType</span>: <span class="hljs-string">'json'</span>,
							<span class="hljs-attr">data</span>:     {
								<span class="hljs-attr">action</span>: <span class="hljs-string">'ithoughts_tt_gl_get_terms_list'</span>,
								<span class="hljs-attr">search</span>: searchedString,
							},
							<span class="hljs-attr">complete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complete</span>(<span class="hljs-params"> res </span>) </span>{
								<span class="hljs-keyword">var</span> response = res.responseJSON;
								<span class="hljs-keyword">if</span> ( <span class="hljs-string">'undefined'</span> == <span class="hljs-keyword">typeof</span> response || !response.success )								{
									<span class="hljs-keyword">return</span>;
								}</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Check if the response contains a different search string as the current one. It serves as an <em>outdated filter</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">if</span> ( response.data.searched !== searchedString ) {
									iThoughtsTooltipGlossary.info( <span class="hljs-string">'Outdated response'</span> );
									<span class="hljs-keyword">return</span>;
								}</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Store terms, then refresh completions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								itge.terms = response.data.terms;
								searchMatchingRes();
							},
						});
					}).on( <span class="hljs-string">'focusout'</span>, losefocustest ).on( <span class="hljs-string">'keyup'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">keyup</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">this</span>.removeAttribute( <span class="hljs-string">'data-term-id'</span> );
					});
				}());</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h3 id="set-up-advanced-configuration">Set up Advanced Configuration</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>				( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initAdvancedConfiguration</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> $opts = $( <span class="hljs-string">'#ithoughts_tt_gl-tooltip-form-options'</span> ),
						$tooltip = $( <span class="hljs-string">'#ithoughts_tt_gl-tooltip-form'</span> ),
						skip = {
							<span class="hljs-attr">span</span>: <span class="hljs-literal">false</span>,
							<span class="hljs-attr">link</span>: <span class="hljs-literal">false</span>,
						},
						$form = $( <span class="hljs-string">'#ithoughts_tt_gl-tooltip-form-options form'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <h5 id="-getoptsobject-get-the-advanced-configuration-object"><code>getOptsObject</code>: Get the advanced configuration object</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-comment">/**
					 * @function getOptsObject
					 * @author agermain
					 * @returns {Object} Advanced Opts objects
					 */</span>
					<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getOptsObject</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">var</span> form = $form[<span class="hljs-number">0</span>],
							formElems = form.elements,
							tristates = {},
							valid = <span class="hljs-literal">true</span>,
							formFields = formElems.length,
							i = <span class="hljs-number">-1</span>,
							attributes = {},
							attributesList = $( <span class="hljs-string">'#attributes-list option'</span> ).map( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAttributeValue</span>(<span class="hljs-params"></span>) </span>{
								<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.value;
							}).toArray(),
							opts,
							types = [ <span class="hljs-string">'span'</span>, <span class="hljs-string">'link'</span> ];</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Check the validity in the whole form</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">while</span> ( ++i &lt; formFields &amp;&amp; valid ) {
							<span class="hljs-keyword">var</span> validity = formElems[i].validity;
							valid &amp;= validity.valid;
							<span class="hljs-keyword">if</span> ( !validity.valid ) {
								formElems[i].focus();
							}
						}</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Get tristate values to override default booleans</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						$form.find( <span class="hljs-string">'.ithoughts-tristate'</span> ).each( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTristateValue</span>(<span class="hljs-params"></span>) </span>{
							$.extend( <span class="hljs-literal">true</span>, tristates, $( <span class="hljs-keyword">this</span> ).serializeInputsObject({
								<span class="hljs-string">'-1'</span>: <span class="hljs-literal">false</span>,
								<span class="hljs-number">0</span>:    <span class="hljs-literal">null</span>,
								<span class="hljs-number">1</span>:    <span class="hljs-literal">true</span>,
							}[<span class="hljs-keyword">this</span>.dataset.state]));
						});</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Once we have retrieved all tristate states, we just have to inject it in the form values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						opts = $.extend( <span class="hljs-literal">true</span>, $form.serializeObject(), tristates );</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Get the key-value attributes on both link &amp; span</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++ ) {
							<span class="hljs-keyword">var</span> type = types[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Create the store</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							attributes[type] = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Iterate on each category to get the value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> arrK = opts[<span class="hljs-string">`attributes-<span class="hljs-subst">${  type  }</span>-key`</span>] || [], arrV = opts[<span class="hljs-string">`attributes-<span class="hljs-subst">${  type  }</span>-value`</span>] || [], j = <span class="hljs-number">0</span>, J = <span class="hljs-built_in">Math</span>.min( arrK.length, arrV.length ); j &lt; J; j++ ) {
								<span class="hljs-keyword">if</span> ( arrK[j] &amp;&amp; arrV[j]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>If the key is not in the list of standard DOM attributes, we have to prefix it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>									<span class="hljs-keyword">var</span> prefix = attributesList.indexOf( arrK[j]) &gt; <span class="hljs-number">-1</span> ? <span class="hljs-string">''</span> : <span class="hljs-string">'data-'</span>;
									attributes[type][prefix + arrK[j]] = arrV[j];
								}
							}</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Clean the options object afterwars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							<span class="hljs-keyword">delete</span> opts[<span class="hljs-string">`attributes-<span class="hljs-subst">${  type  }</span>-value`</span>];
							<span class="hljs-keyword">delete</span> opts[<span class="hljs-string">`attributes-<span class="hljs-subst">${  type  }</span>-key`</span>];
						}</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Add the attributes in the options object, then return it;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						opts[<span class="hljs-string">'attributes'</span>] = attributes;
						<span class="hljs-keyword">return</span> opts;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h5 id="-filterprototypeinputs-used-in-filter-to-ignore-if-the-element-is-a-prototype-used-in-key-value-handlings"><code>filterPrototypeInputs</code>: Used in filter to ignore if the element is a prototype. Used in key-value handlings</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-comment">/**
					 * @function filterPrototypeInputs
					 * @description Filtering function for prototypes. Used in key-value handlings
					 * @author gerkin
					 * @returns {Boolean} True if this element is not a prototype
					 */</span>
					<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterPrototypeInputs</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">return</span> <span class="hljs-number">0</span> === $( <span class="hljs-keyword">this</span> ).closest( <span class="hljs-string">'.ithoughts-prototype'</span> ).length;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <h5 id="-checkremoveattr-remove-unused-key-value-pairs-from-the-key-value-editor"><code>checkRemoveAttr</code>: Remove unused key/value pairs from the key/value editor</h5>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-comment">/**
					 * @function checkRemoveAttr
					 * @description Remove unused key/value pairs from the key/value editor
					 * @author gerkin
					 * @returns {undefined}
					 */</span>
					<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkRemoveAttr</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Separate the current event emitter event from other input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> thisInput = $( <span class="hljs-keyword">this</span> ),
							$container = thisInput.parent().parent(),
							otherInput = $container.find( <span class="hljs-string">'input'</span> ).filter( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterNotThisInput</span>(<span class="hljs-params"></span>) </span>{
								<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> !== thisInput.get( <span class="hljs-number">0</span> );
							});</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Wait to let some time to the browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ensureRemoveContainer</span>(<span class="hljs-params"></span>) </span>{
							<span class="hljs-keyword">var</span> type = thisInput.closest( <span class="hljs-string">'.ithoughts-attrs-container'</span> ).attr( <span class="hljs-string">'data-attr-family'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Test &amp; clean the <code>skip</code> flag if required</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							<span class="hljs-keyword">if</span> ( skip[type]) {
								skip[type] = <span class="hljs-literal">false</span>;
								<span class="hljs-keyword">return</span>;
							}</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Filter values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							thisInput.val( thisInput.val().trim());
							otherInput.val( otherInput.val().trim());</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>If both values are empty &amp; none have the focus, then remove the container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							<span class="hljs-keyword">if</span> ( !thisInput.val() &amp;&amp; !otherInput.val() &amp;&amp; <span class="hljs-built_in">document</span>.activeElement !== thisInput.get( <span class="hljs-number">0</span> ) &amp;&amp; <span class="hljs-built_in">document</span>.activeElement !== otherInput.get( <span class="hljs-number">0</span> )) {
								$container.remove();
							}
						}, <span class="hljs-number">100</span> );
					}

					$opts.find( <span class="hljs-string">'input[type="checkbox"].ithoughts-tristate'</span> ).attr( <span class="hljs-string">'data-state'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTristateValue</span>(<span class="hljs-params"> i, attrVal </span>) </span>{
						<span class="hljs-keyword">return</span> (( attrVal || <span class="hljs-number">0</span> ) - <span class="hljs-number">1</span> ) % <span class="hljs-number">3</span> + <span class="hljs-number">2</span>;
					}).change( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTristateChange</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Do the state rotation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">var</span> s = $( <span class="hljs-keyword">this</span> ),
							ts = (( s.attr( <span class="hljs-string">'data-state'</span> )||<span class="hljs-number">0</span> ) - <span class="hljs-number">2</span> ) % <span class="hljs-number">3</span> + <span class="hljs-number">1</span>;
						s.attr( <span class="hljs-string">'data-state'</span>, ts );
						<span class="hljs-keyword">this</span>.checked = <span class="hljs-number">1</span> === ts;
						<span class="hljs-keyword">this</span>.indeterminate = <span class="hljs-number">0</span> === ts;
					}).change();</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Bind GUI to show, close or save options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$( <span class="hljs-string">'#ithoughts_tt_gl-tinymce-advanced_options'</span> ).click( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showAttributesWindow</span>(<span class="hljs-params"></span>) </span>{
						$opts.show();
						$tooltip.hide();
					});
					$( <span class="hljs-string">'#ithoughts_tt_gl-tinymce-close-attrs'</span> ).click( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeDiscardAttributesWindow</span>(<span class="hljs-params"></span>) </span>{
						$opts.hide();
						$tooltip.show();
					});
					$( <span class="hljs-string">'#ithoughts_tt_gl-tinymce-validate-attrs'</span> ).click( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeAcceptAttributesWindow</span>(<span class="hljs-params"></span>) </span>{
						tooltipOpts = getOptsObject();
						$opts.hide();
						$tooltip.show();
					});</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Bind events for the option that keep the tip opened for some times before closing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$( <span class="hljs-string">'#qtip-keep-open'</span> ).change( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onQtipKeepOpenChange</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">var</span> modeInput = $( <span class="hljs-string">'#qtiptrigger'</span> ),
							textInput = $( <span class="hljs-string">'#qtiptriggerText'</span> ),
							mtInput = $([ modeInput, textInput ]),
							oldValue;</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>This option force the opening event to be <code>click</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lockQtipTrigger</span>(<span class="hljs-params"></span>) </span>{
							modeInput.prop( <span class="hljs-string">'disabled'</span>, <span class="hljs-keyword">this</span>.checked );
							textInput.prop( <span class="hljs-string">'disabled'</span>, !<span class="hljs-keyword">this</span>.checked );
							mtInput.val( <span class="hljs-keyword">this</span>.checked ? <span class="hljs-string">'click'</span> : oldValue );
							<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.checked ) {
								oldValue = modeInput.value;
							} <span class="hljs-keyword">else</span> {
								modeInput.disabled = !( textInput.disabled = <span class="hljs-literal">true</span> );
							}
						};
					}());</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Bind Position selects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$( <span class="hljs-string">'[name^="position[my]"]'</span> ).change( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onPositionMyChange</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">var</span> base = <span class="hljs-string">'#position[my]['</span>,
							inputV = $( <span class="hljs-string">`<span class="hljs-subst">${ base  }</span>1]`</span> ),
							inputH = $( <span class="hljs-string">`<span class="hljs-subst">${ base  }</span>2]`</span> ),
							inputsHV = $( inputH.get( <span class="hljs-number">0</span> ), inputV.get( <span class="hljs-number">0</span> )),
							inputS = $( <span class="hljs-string">`<span class="hljs-subst">${ base  }</span>invert]`</span> );
						<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changePositionMy</span>(<span class="hljs-params"></span>) </span>{
							inputsHV.prop( <span class="hljs-string">'required'</span>, inputV.val() || inputH.val() || inputS.prop( <span class="hljs-string">'checked'</span> ));
						};
					}());
					$( <span class="hljs-string">'[name^="position[at]"]'</span> ).change( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onPositionAtChange</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">var</span> base = <span class="hljs-string">'#position[at]['</span>,
							inputV = $( <span class="hljs-string">`<span class="hljs-subst">${ base  }</span>1]`</span> ),
							inputH = $( <span class="hljs-string">`<span class="hljs-subst">${ base  }</span>2]`</span> ),
							inputsHV = $( inputH.get( <span class="hljs-number">0</span> ), inputV.get( <span class="hljs-number">0</span> ));
						<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changePositionMy</span>(<span class="hljs-params"></span>) </span>{
							inputsHV.prop( <span class="hljs-string">'required'</span>, inputV.val() || inputH.val());
						};
					}());</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Initialize key/value pairs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$( <span class="hljs-string">'.kv-pair-link-attrs-add,.kv-pair-span-attrs-add'</span> ).bind( <span class="hljs-string">'mouseup touchend'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKvPairAdd</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">var</span> $container = $( <span class="hljs-keyword">this</span> ).parent().find( <span class="hljs-string">'.ithoughts-attrs-container'</span> ),
							$invalidInputs = $container.find( <span class="hljs-string">'input:invalid'</span> ).filter( filterPrototypeInputs ),
							type = $container.attr( <span class="hljs-string">'data-attr-family'</span> );
						skip[type] = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Check if every empty pairs are deleted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">if</span> ( $invalidInputs.length &gt; <span class="hljs-number">0</span> ) {
							skip[type] = <span class="hljs-literal">true</span>;
							$invalidInputs.eq( <span class="hljs-number">0</span> ).focus();
							checkRemoveAttr.call( $invalidInputs.get( <span class="hljs-number">0</span> ));
							skip[type] = <span class="hljs-literal">false</span>;
							<span class="hljs-keyword">return</span>;
						}

						<span class="hljs-keyword">var</span> $prototype = $container.find( <span class="hljs-string">'.ithoughts-prototype'</span> ),
							$clone = $prototype.clone().removeClass( <span class="hljs-string">'ithoughts-prototype'</span> ),
							newIdParts = [
								<span class="hljs-string">`attributes-<span class="hljs-subst">${ type }</span>-`</span>,
								<span class="hljs-string">`-<span class="hljs-subst">${ <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() }</span>`</span>,
							];</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Set the id/for attribute in the template</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						$clone.find( <span class="hljs-string">'.dynamicId'</span> ).each( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setForOrId</span>(<span class="hljs-params"></span>) </span>{
							<span class="hljs-keyword">var</span> $<span class="hljs-keyword">this</span> = $( <span class="hljs-keyword">this</span> ),
								newId = newIdParts[<span class="hljs-number">0</span>] + ( $<span class="hljs-keyword">this</span>.hasClass( <span class="hljs-string">'dynamicId-key'</span> ) ? <span class="hljs-string">'key'</span> : <span class="hljs-string">'value'</span> ) + newIdParts[<span class="hljs-number">1</span>];
							$<span class="hljs-keyword">this</span>.attr( <span class="hljs-string">'LABEL'</span> === <span class="hljs-keyword">this</span>.tagName ? <span class="hljs-string">'for'</span> : <span class="hljs-string">'id'</span>, newId );
						});
						$container.append( $clone );</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Enable inputs, then focus the first one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						$clone.find( <span class="hljs-string">'input'</span> ).prop( <span class="hljs-string">'required'</span>, <span class="hljs-literal">true</span> ).prop( <span class="hljs-string">'disabled'</span>, <span class="hljs-literal">false</span> ).blur( checkRemoveAttr ).eq( <span class="hljs-number">0</span> ).focus();
						checkRemoveAttr.call( $clone.find( <span class="hljs-string">'input'</span> ).get( <span class="hljs-number">0</span> ));
					});
					$( <span class="hljs-string">'.ithoughts-attrs-container input'</span> ).blur( checkRemoveAttr );
					tooltipOpts = getOptsObject();
				})();</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>This event listener generate a different tag with a different base url depending on the source of the video.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$( <span class="hljs-string">'#mediatip_url_video_link'</span> ).bind( <span class="hljs-string">'keyup mouseup change click focusin focusout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">videoUrlChanged</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> videodata = <span class="hljs-literal">null</span>,
						value = <span class="hljs-keyword">this</span>.value,
						formatType;</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Configure sources. See below for usage of those config objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> formats = {
						<span class="hljs-attr">youtube</span>: {
							<span class="hljs-attr">regex</span>: <span class="hljs-regexp">/^(?:https?:\/\/(?:youtu\.be\/|\w*\.youtube\.\w{2,3}\/watch\?v=)|&lt;iframe .*?src="https?:\/\/\w*\.youtube\.\w{2,3}\/embed\/)([a-zA-Z0-9]*).*$/</span>,
							<span class="hljs-attr">embed</span>: <span class="hljs-string">'&lt;iframe width="512" height="288" src="https://www.youtube.com/embed/$1" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;'</span>,
							<span class="hljs-attr">video</span>: <span class="hljs-string">'https://www.youtube.com/watch?v=$1'</span>,
						},
						<span class="hljs-attr">dailymotion</span>: {
							<span class="hljs-attr">regex</span>: <span class="hljs-regexp">/^(?:https?:\/\/(?:dai\.ly\/|\w*\.dailymotion\.\w{2,3}\/video\/)|&lt;iframe .*?src=".*?\w*\.dailymotion\.\w{2,3}\/embed\/video\/)([a-zA-Z0-9]*).*/</span>,
							<span class="hljs-attr">embed</span>: <span class="hljs-string">'&lt;iframe width="512" height="288" src="https://www.dailymotion.com/embed/video/$1" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;'</span>,
							<span class="hljs-attr">video</span>: <span class="hljs-string">'https://www.dailymotion.com/video/$1'</span>,
						},
						<span class="hljs-attr">direct</span>: {
							<span class="hljs-attr">regex</span>: <span class="hljs-regexp">/^(.*\.mp4)(\?.*)?$/</span>,
							<span class="hljs-attr">embed</span>: <span class="hljs-string">'&lt;video width="512" height="288" controls="controls"&gt;&lt;source src="$1" type="video/mp4" /&gt;&lt;/video&gt;'</span>,
							<span class="hljs-attr">video</span>: <span class="hljs-string">'$1'</span>,
						},
					};</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Iterate on each configured type and try to match with one configured source</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> type <span class="hljs-keyword">in</span> formats ) {
						formatType = formats[type];</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>If the regex match, then we have found our source. We can then generate the embed tag &amp; the video url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">if</span> ( value.match( formatType.regex )) {
							videodata = {
								<span class="hljs-attr">embed</span>: value.replace( formatType.regex, formatType.embed ),
								<span class="hljs-attr">video</span>: value.replace( formatType.regex, formatType.video ),
							};
							<span class="hljs-keyword">break</span>;
						}
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Set the form inputs with new values. Note that we refresh also the video url input to ensure a consistent formatting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> ( videodata ) {
						$( <span class="hljs-string">'#mediatip_url_video_embed'</span> ).val( videodata.embed );
						$( <span class="hljs-keyword">this</span> ).val( videodata.video );
					}
				}).keyup();</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>On click on the validate button, extract all required data from the form</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$( <span class="hljs-string">'#ithoughts_tt_gl-tinymce-validate'</span> ).click( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> data = {
						<span class="hljs-attr">type</span>: [ <span class="hljs-string">'glossary'</span>, <span class="hljs-string">'tooltip'</span>, <span class="hljs-string">'mediatip'</span> ][$( <span class="hljs-string">'.tabs li.active'</span> ).index()],
						<span class="hljs-attr">text</span>: $( <span class="hljs-string">'#ithoughts_tt_gl_text'</span> ).val(),
						<span class="hljs-attr">link</span>: $( <span class="hljs-string">'#ithoughts_tt_gl_link'</span> ).val(),
						<span class="hljs-attr">opts</span>: tooltipOpts,
					};
					itge.log( <span class="hljs-string">'Before per-type form data handling:'</span>, data );</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Depending on the target type of the tooltip, we have to retrieve specific data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">switch</span> ( data.type ) {
						<span class="hljs-keyword">case</span> <span class="hljs-string">'glossary'</span>: {
							data = $.extend( data, {
								<span class="hljs-attr">glossary_id</span>:              $( <span class="hljs-string">'[name="glossary_term_id"]'</span> ).val(),</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p><code>disable_auto_translation</code> is related to WPML</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								disable_auto_translation: $( <span class="hljs-string">'[name="glossary_disable_auto_translation"]'</span> ).is( <span class="hljs-string">':checked'</span> ),
							});
						} <span class="hljs-keyword">break</span>;

						<span class="hljs-keyword">case</span> <span class="hljs-string">'tooltip'</span>: {
							data = $.extend( data, {
								<span class="hljs-attr">tooltip_content</span>: tinymce.EditorManager.get( <span class="hljs-string">'ithoughts_tt_gl-tooltip-content'</span> ).getContent() || $( <span class="hljs-string">'#ithoughts_tt_gl-tooltip-content'</span> ).val(),
							});
						} <span class="hljs-keyword">break</span>;

						<span class="hljs-keyword">case</span> <span class="hljs-string">'mediatip'</span>: {
							data = $.extend( data, {
								<span class="hljs-attr">mediatip_type</span>: $( <span class="hljs-string">'#mediatip_type'</span> ).val(),
							});</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Mediatips has their own switch, depending on the type of media</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							<span class="hljs-keyword">switch</span> ( data.mediatip_type ) {
								<span class="hljs-keyword">case</span> <span class="hljs-string">'localimage'</span>: {
									data = $.extend( data, {
										<span class="hljs-attr">mediatip_content</span>: $( <span class="hljs-string">'#image-box-data'</span> ).val(),
										<span class="hljs-attr">mediatip_caption</span>: $( <span class="hljs-string">'#mediatip_caption'</span> ).val(),
									});
								} <span class="hljs-keyword">break</span>;

								<span class="hljs-keyword">case</span> <span class="hljs-string">'webimage'</span>: {
									data = $.extend( data, {
										<span class="hljs-attr">mediatip_content</span>: $( <span class="hljs-string">'#mediatip_url_image'</span> ).val(),
										<span class="hljs-attr">mediatip_caption</span>: $( <span class="hljs-string">'#mediatip_caption'</span> ).val(),
									});
								} <span class="hljs-keyword">break</span>;

								<span class="hljs-keyword">case</span> <span class="hljs-string">'webvideo'</span>: {
									data = $.extend( data, {
										<span class="hljs-attr">mediatip_content</span>: $( <span class="hljs-string">'#mediatip_url_video_embed'</span> ).val(),
										<span class="hljs-attr">mediatip_link</span>:    $( <span class="hljs-string">'#mediatip_url_video_link'</span> ).val(),
									});
								} <span class="hljs-keyword">break</span>;
							}
						} <span class="hljs-keyword">break</span>;
									   }
					closeForm( data );
				});
				$( <span class="hljs-string">'.ithoughts_tt_gl-tinymce-discard'</span> ).click( closeForm.bind( <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span> ));
			}());</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <h2 id="list-form">List form</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-string">'LIST'</span> === formType ) {
			( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initListForm</span>(<span class="hljs-params"></span>) </span>{
				initTab( $( <span class="hljs-string">'.tabs li'</span> ));

				( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initGroupsPicker</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> $ids = $( <span class="hljs-string">'#groups'</span> ),
						$text = $( <span class="hljs-string">'#groups_text'</span> ),
						$groupsPicker = $( <span class="hljs-string">'.groupspicker'</span> ),
						$catchEvent = $([ $groupsPicker.get( <span class="hljs-number">0</span> ), $text.parent().get( <span class="hljs-number">0</span> ) ]),
						$checkboxes = $( <span class="hljs-string">'.groupspicker .group-select input'</span> );
					$text.focusin( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onGroupsPickerFocus</span>(<span class="hljs-params"></span>) </span>{
						$groupsPicker.toggleClass( <span class="hljs-string">'hidden'</span> );

						<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">catchEvent</span>(<span class="hljs-params"> e </span>) </span>{
							e.stopImmediatePropagation();
						}
						<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hide</span>(<span class="hljs-params"></span>) </span>{
							$groupsPicker.toggleClass( <span class="hljs-string">'hidden'</span> );
							$catchEvent.off( <span class="hljs-string">'click'</span>, catchEvent );
						}
						$catchEvent.click( catchEvent );
						$w.one( <span class="hljs-string">'click'</span>, hide );
					});</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Enable glossary group checkboxes (for the group picker)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					$checkboxes.change( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onGroupCheckboxChanged</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">var</span> $checked = $checkboxes.filter( <span class="hljs-string">':checked'</span> ),
							texts = [],
							ids = [];

						$checked.each( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkedAppendToArray</span>(<span class="hljs-params"></span>) </span>{
							texts.push( $( <span class="hljs-keyword">this</span> ).parent().find( <span class="hljs-string">'.group-title'</span> ).text());
							ids.push( $( <span class="hljs-keyword">this</span> ).val());
						});
						$ids.val( ids.join( <span class="hljs-string">','</span> ));
						$text.val( texts.join( <span class="hljs-string">', '</span> ));
					}).change();
				}());

				$( <span class="hljs-string">'#ithoughts_tt_gl-tinymce-validate'</span> ).click( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onClickValidate</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Compose basic infos from raw datas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">var</span> data = {
						<span class="hljs-attr">type</span>:  [ <span class="hljs-string">'atoz'</span>, <span class="hljs-string">'list'</span> ][$( <span class="hljs-string">'.tabs li.active'</span> ).index()],
						<span class="hljs-attr">alpha</span>: $( <span class="hljs-string">'#letters'</span> ).val(),
						<span class="hljs-attr">group</span>: $( <span class="hljs-string">'#groups'</span> ).val(),
					};</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Remove useless fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> ( !data.alpha ) {
						<span class="hljs-keyword">delete</span> data.alpha;
					}
					<span class="hljs-keyword">if</span> ( !data.group ) {
						<span class="hljs-keyword">delete</span> data.group;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Switch for particular lists (Here, atoz isn’t required as it does not have any additionnal parameters. This list may be extended in the future)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">switch</span> ( data.type ) {
						<span class="hljs-keyword">case</span> <span class="hljs-string">'list'</span>: {
							$.extend( data, {
								<span class="hljs-attr">desc</span>: $( <span class="hljs-string">'#description_mode'</span> ).val(),
								<span class="hljs-attr">cols</span>: $( <span class="hljs-string">'#columns_count'</span> ).val(),
							});
						} <span class="hljs-keyword">break</span>; 
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Finally, return the data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					itge.finishListTinymce( data );
				});
				$( <span class="hljs-string">'.ithoughts_tt_gl-tinymce-discard'</span> ).click( <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onClickDiscard</span>(<span class="hljs-params"></span>) </span>{
					itge.finishListTinymce();
				});
			}());
		}
	});
})( iThoughts.v5 );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
